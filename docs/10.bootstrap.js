(self.webpackChunkcreate_wasm_app=self.webpackChunkcreate_wasm_app||[]).push([[10],{10:(e,n,t)=>{"use strict";t.a(e,(async e=>{t.r(n),t(411),t(162);var i=t(640),r=t(406),a=t(690),o=t(36),d=t(340),s=t(760),l=t(142),p=t(555),c=t(593),u=t(370),f=t(356),_=e([a,r]);[a,r]=_.then?await _:_,console.log(window.location.pathname),"/"===window.location.pathname?(0,s.Z)():"/garage"===window.location.pathname?(0,l.j)():"/journey"===window.location.pathname?(0,c.E)():"/journey-garage"===window.location.pathname?(0,f.D)():window.location.pathname.includes("/journey-")?(0,u.S)(window.location.pathname.split("journey-")[1]):"/sound"===window.location.pathname?(0,p.U)():"/home"===window.location.pathname?(0,i.L)():"/playground"===window.location.pathname?(0,d.L)():"/gallery"===window.location.pathname?(0,r.l)():"/webgpu"===window.location.pathname?(0,a.M)():"/localhost_3d"===window.location.pathname?(0,o.z)():console.error("404")}))},32:(e,n,t)=>{"use strict";t.d(n,{N:()=>i});const i={default:0,WATER:1,FIRE:2,ELECTRIC:3,METAL:4,TURBO:5,COCKPIT:6,WOOD:7,LEAF:8,ROCK:9,CORE:10,RADAR:11}},737:(e,n,t)=>{"use strict";t.d(n,{ZH:()=>c,FR:()=>p,aV:()=>o,eG:()=>l,hU:()=>u});var i=t(603);const r=(e,n)=>({x:a(e)*n.x,y:e.canvas.height-a(e)*n.y}),a=e=>Math.min(e.canvas.width,e.canvas.height),o=(e,n,t,i=14,a="#fff")=>{t=`${t}`;const o=r(e,n);e.font=`${i}px monospace`,e.fillStyle=a,e.fillText(t,o.x-i*t.length*.3,o.y+.33*i)},d=(e,n,t,i)=>{const o=.005;if(n.x<o||n.y<o||n.x>1-o||n.y>1-o)return;const d=r(e,n),s=t*a(e)*.5;e.beginPath(),e.arc(d.x,d.y,s,0,2*Math.PI,!1),e.fillStyle=i,e.fill()},s=(e,n,t,i,o)=>{const d=r(e,n),s=t*a(e)*.5;e.beginPath(),e.arc(d.x,d.y,s,0,2*Math.PI,!1),e.strokeStyle=i,e.lineWidth=o||2,e.stroke()},l=(e,n,t,i,r)=>{for(var a of[[0,0],[1,0],[0,1],[0,-1],[-1,0]]){const o={x:n.x+a[0],y:n.y+a[1]};s(e,o,t,i,r)}},p=(e,n,t,r)=>{if((0,i.uE)(n,{x:.5,y:.5})<.2025)d(e,n,t,r);else for(var a of[[0,0],[1,0],[0,1],[0,-1],[-1,0]]){const i={x:n.x+a[0],y:n.y+a[1]};d(e,i,t,r)}},c=e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height)},u=e=>{const n=Math.min(window.innerWidth,window.innerHeight);e.width=n,e.height=n}},189:(e,n,t)=>{"use strict";t.d(n,{O:()=>i});const i={emerald:{value:{0:"#0ff8",1:"#0ff8",undefined:"#0ff8"},score:3},glass:{value:{0:"#aaf3",1:"#aaf3",undefined:"#aaf3"},score:4},booster:{value:"#fb0",value_1:"#fa0",value_2:"#f80",value_3:"#f00",score:2},core:{value:{0:"#ffa",1:"#ffa",undefined:"#fda"},score:4},armor:{value:{0:"#aafe",1:"#afae",undefined:"#faae"},score:3},gun:{value:{0:"#f88",1:"#f88",undefined:"#f88"},score:1},option:{value:{0:"#faf",1:"#faf",undefined:"#faf"}},"link-option":{value:{0:"#afa",1:"#afa",undefined:"#afa"}}}},406:(e,n,t)=>{"use strict";t.a(e,(async e=>{t.d(n,{l:()=>p});var i=t(650),r=(t(411),t(162),t(361)),a=t(437),o=t(209),d=t(291),s=e([r,i]);[r,i]=s.then?await s:s;const l=13;function p(){let e=!1;const n=window.location.search.replace("?","").split("&");for(var t of n){const n=t.split("=")[0],i=t.split("=")[1];"webgpu"===n&&"true"===i&&(e=!0)}document.getElementById("content").innerHTML='<canvas id="canvas"></canvas>\n<div id="panel">\n<div id="menu">\n  <a href="/playground">Playground</a>\n  <a href="/gallery">Gallery</a>\n  <a href="/gallery?webgpu=true">Gallery (WebGPU)</a>\n</div>\n  <canvas id="minimap"></canvas>\n  <div>\n    Zoom: <input type="range" min="0" max="1000" value="0" id="zoom_slider">\n  </div>\n  <div>\n    x: <input type="range" min="0" max="1000" value="500" id="x_slider">\n  </div>\n  <div>\n    y: <input type="range" min="0" max="1000" value="500" id="y_slider">\n  </div>\n  <p id="p_step"></p>\n  <p id="p_fps"></p>\n  <p id="p_render_duration"></p>\n  <p id="p_cps"></p>\n  <p id="p_compute_duration"></p>\n  <p id="p_pids"></p>\n  <pre id="p_counter_global"></pre>\n  <pre id="p_counter_activity"></pre>\n  <pre id="p_counter_collision"></pre>\n  <pre id="p_counter_linked"></pre>\n  <p id="p_energy"></p>\n</div>';const r=i.xF.new(128,128),d=i.fU.new(5,.25,5);d.add(0,1,6),d.add(1,0,7);d.add(1,3,3),d.add(3,0,3),d.add(1,4,5),d.add(5,0,5),d.add(1,6,6),d.add(7,0,6),d.add(6,4,5),d.add(5,7,5),r.add_entity(d,i.E9.new(0,0));for(var s=0;s<10;s++)r.add_entity(d,i.E9.new(Math.random(),Math.random()));if(g(r),!0===e)if("gpu"in navigator)!async function(e){const n=await navigator.gpu.requestAdapter();if(!n)return void console.error("No gpu adapter found");const t={buffer_size:212992},i={data_buffer_size:t.buffer_size,image_width:Math.floor(.5*window.innerWidth),image_height:Math.floor(.5*window.innerHeight),max_parts_sqrt:64};i.device=await n.requestDevice(),i.buffers={write:i.device.createBuffer({size:t.buffer_size,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),in:i.device.createBuffer({size:t.buffer_size,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),out:i.device.createBuffer({size:u(i),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),previous_img:i.device.createBuffer({size:u(i),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),read:i.device.createBuffer({size:u(i),usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),write_data:i.device.createBuffer({size:48,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),in_data:i.device.createBuffer({size:48,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC})},i.bind_group_layouts={reset:i.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),trace:i.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]})},i.bind_groups={reset:i.device.createBindGroup({layout:i.bind_group_layouts.reset,entries:[{binding:0,resource:{buffer:i.buffers.previous_img}},{binding:1,resource:{buffer:i.buffers.out}}]}),trace:i.device.createBindGroup({layout:i.bind_group_layouts.trace,entries:[{binding:0,resource:{buffer:i.buffers.in}},{binding:1,resource:{buffer:i.buffers.out}},{binding:2,resource:{buffer:i.buffers.in_data}}]})},i.workgroup_size=16,i.dispatch=Math.ceil(64/i.workgroup_size),i.compute_pipelines={reset:i.device.createComputePipeline({layout:i.device.createPipelineLayout({bindGroupLayouts:[i.bind_group_layouts.reset]}),compute:{module:i.device.createShaderModule({code:a.U(i)}),entryPoint:"main"}}),trace:i.device.createComputePipeline({layout:i.device.createPipelineLayout({bindGroupLayouts:[i.bind_group_layouts.trace]}),compute:{module:i.device.createShaderModule({code:o.U(i)}),entryPoint:"main"}})};const r=document.getElementById("canvas");r.width=i.image_width,r.height=i.image_height,r.style.width=window.innerWidth+"px",r.style.height=window.innerHeight+"px";c(e,i,r.getContext("2d"))}(r);else{const e="Gravitle works best with WebGPU.\nInstructions on how to enable at https://web.dev/gpu/#use";alert(e),console.error(e),m(r)}else m(r)}async function c(e,n,t){const i=performance.now();void 0===n.fps_counter&&(n.fps_counter=[]),void 0===n.fps_counter_length&&(n.fps_counter_length=100);const a=Math.max(canvas.width,canvas.height),o={x:document.getElementById("x_slider").value/1e3,y:document.getElementById("y_slider").value/1e3,zoom:1e3/(1e3-document.getElementById("zoom_slider").value)},s=f(o,a),p=(s.canvas,new Float32Array(new Float32Array(r.memory.buffer,e.parts_ptr(),l*e.parts_count()))),m=(canvas.width,canvas.height,o.x-.5/o.zoom*n.image_width/a),g=o.y-.5/o.zoom*n.image_height/a,y=m+1/o.zoom*n.image_width/a,h=g+1/o.zoom*n.image_height/a;for(let n=0;n<e.parts_count();n++){const e=p[n*l+0],t=p[n*l+1];_(e,t,p[n*l+4],s,!(m<=e&&e<=y&&g<=t&&t<=h))}let b=n.buffers.write.mapAsync(GPUMapMode.WRITE),x=n.buffers.write_data.mapAsync(GPUMapMode.WRITE);await b,await x,new Float32Array(n.buffers.write.getMappedRange()).set(p);const w=e.parts_count();new Float32Array(n.buffers.write_data.getMappedRange()).set([o.zoom,o.x,o.y,w,n.image_width,n.image_height,m,g,y,h,performance.now(),e.get_step()/1]),n.buffers.write.unmap(),n.buffers.write_data.unmap();{const e=n.device.createCommandEncoder(),t=e.beginComputePass();t.setPipeline(n.compute_pipelines.reset),t.setBindGroup(0,n.bind_groups.reset),t.dispatch(n.image_width,n.image_height),t.endPass();const i=e.finish();n.device.queue.submit([i])}{const e=n.device.createCommandEncoder();e.copyBufferToBuffer(n.buffers.write,0,n.buffers.in,0,n.data_buffer_size),e.copyBufferToBuffer(n.buffers.write_data,0,n.buffers.in_data,0,48);const t=e.beginComputePass();t.setPipeline(n.compute_pipelines.trace),t.setBindGroup(0,n.bind_groups.trace),t.dispatch(n.dispatch,n.dispatch),t.endPass(),e.copyBufferToBuffer(n.buffers.out,0,n.buffers.read,0,u(n)),e.copyBufferToBuffer(n.buffers.out,0,n.buffers.previous_img,0,u(n));const i=e.finish();n.device.queue.submit([i])}let v=n.buffers.read.mapAsync(GPUMapMode.READ);await v,t.putImageData(new ImageData(Uint8ClampedArray.from(new Uint32Array(n.buffers.read.getMappedRange())),n.image_width,n.image_height),0,0),n.buffers.read.unmap(),document.getElementById("p_counter_global").innerHTML=`Global:      ${e.get_counter_value(0).toFixed(2)}ms`,(0,d.O)(n),window.requestAnimationFrame((function(){c(e,n,t)}));const k=performance.now();n.fps_counter.push({start:i,end:k,duration:k-i})}function u(e){return e.image_width*e.image_height*4*4}function f(e,n){const t=document.getElementById("minimap");t.width=256,t.height=256;const i=t.getContext("2d");return i.beginPath(),i.fillStyle="#ff000088",i.rect(e.x*t.width-.5*t.width/e.zoom,e.y*t.height-.5*t.height/e.zoom,t.width/e.zoom,t.height/e.zoom),i.fill(),i.beginPath(),i.fillStyle="#FFFF0088",i.rect(e.x*t.width-.5*t.width/e.zoom*canvas.width/n,e.y*t.height-.5*t.height/e.zoom*canvas.height/n,t.width/e.zoom*canvas.width/n,t.height/e.zoom*canvas.height/n),i.fill(),i.fillStyle="#000",i}function _(e,n,t,i,r){i.fillStyle=r?"#888":"#000",i.beginPath(),i.arc(e*minimap.width,n*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc((e+1)*minimap.width,n*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc((e-1)*minimap.width,n*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(e*minimap.width,(n+1)*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(e*minimap.width,(n-1)*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill()}function m(e){const n=document.getElementById("canvas");n.width=window.innerWidth,n.height=window.innerHeight,n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px";const t=n.getContext("2d"),i=Math.max(n.width,n.height),a={x:document.getElementById("x_slider").value/1e3,y:document.getElementById("y_slider").value/1e3,zoom:1e3/(1e3-document.getElementById("zoom_slider").value)},o=f(a,i),d=(o.canvas,new Float32Array(r.memory.buffer,e.parts_ptr(),l*e.parts_count())),s=.5*(1-1/a.zoom),p=s*n.width/i,c=s*n.height/i,u=(i-n.width)/i*.5,g=(i-n.height)/i*.5;for(let n=0;n<e.parts_count();n++){const e=d[n*l+0],r=d[n*l+1],s=d[n*l+4];_(e,r,s,o),t.fillStyle="#aaa",t.beginPath(),t.arc((e+.5-a.x-p-u)*a.zoom*i,(r+.5-a.y-c-g)*a.zoom*i,s*i*.5*a.zoom,0,2*Math.PI),t.fill()}window.requestAnimationFrame((function(){m(e)}))}function g(e){e.tick(),window.setTimeout((async function(){await g(e)}),5)}}))},142:(e,n,t)=>{"use strict";t.d(n,{j:()=>I});var i=t(250),r=t(45),a=t(737),o=t(603);const d=[],s=[],l=new Map,p=[],c=[],u=(e,n,t=1)=>(0,o.uE)(e,n.p)<n.d*n.d*.25*t,f=(e,n,t,i,r,a,o=g)=>{const s=d.length;return d.push({idx:s,kind:r,d:o,p:{x:e,y:n},player_id:a,links:new Set,direction:{x:0,y:0}}),m(d[s]),s},_=(e,n)=>{const t=e<n?`${e}|${n}`:`${n}|${e}`;let i=d[e],r=d[n];if(l.has(t))return l.get(t);{const a=s.length;return s.push({idx:a,a:e,b:n,d:.5*g,p:{x:.5*(i.p.x+r.p.x),y:.5*(i.p.y+r.p.y)}}),l.set(t,a),d[e].links.add({part_idx:n,link_idx:a}),d[n].links.add({part_idx:e,link_idx:a}),a}},m=e=>{const n=(0,o.IH)(e.p,{x:1*g,y:0});for(var t=0;t<6;t++){const i=(0,o.U1)(e.p,n,t/6);for(let n of d)if(u(i,n)&&!n.deleted){const t=_(e.idx,n.idx);s[t].deleted=!1}}},g=.04,y=(e,n,t=g)=>{for(let t of p)if(u({x:e,y:n},t))return;const i=p.length;p.push({idx:i,d:t,p:{x:e,y:n},kind:"option"})},h=(e,n,t=g)=>{for(let t of c)if(u({x:e,y:n},t))return;const i=[],r=(0,o.IH)({x:e,y:n},{x:.5*g,y:0});for(var a=0;a<6;a++){const t=(0,o.U1)({x:e,y:n},r,a/6);for(let e of d)!e.deleted&&u(t,e,.2)&&i.push(e.idx)}if(2!=i.length)return;const s=c.length;c.push({idx:s,d:t,p:{x:e,y:n},kind:"link-option"})},b=e=>{const n=(0,o.IH)(e.p,{x:g,y:0}),t=(0,o.IH)(e.p,{x:.5*g,y:0});for(var i=0;i<6;i++){const r=(0,o.U1)(e.p,n,i/6);y(r.x,r.y);const a=(0,o.U1)(e.p,t,i/6);h(a.x,a.y,.5*g)}},x=()=>{p.length=0,c.length=0;for(let e of d)e.deleted||b(e);v()},w={x:-1,y:-1},v=()=>{localStorage.setItem("ship",JSON.stringify(S(k()))),console.log("Ship saved")},k=()=>{const e=JSON.parse(JSON.stringify(s)),n=JSON.parse(JSON.stringify(d));let t=0;for(let e of n)e.deleted||(n[e.idx].idx_mieux=t,t+=1);const i=[],r=[];for(let e of n)e.deleted||i.push({p:{x:.25*(e.p.x-.5)+.8,y:.25*(e.p.y-.5)+.8},d:.25*e.d,np:{x:.25*(e.p.x-.5)+.8,y:.25*(e.p.y-.5)+.8},player_id:e.player_id,kind:e.kind,binding:e.binding});for(let t of e)t.deleted||r.push({a:n[t.a].idx_mieux,b:n[t.b].idx_mieux});return{links:r,parts:i,center:{x:.8,y:.8},DIAM:.25*g}},S=e=>{const n=JSON.parse(JSON.stringify(e));for(let e of n.parts)delete e.np;return n},P=e=>{(0,r.H)(e,d,p,c,w,s),document.querySelector("#parts_count").innerHTML=d.filter((e=>!e.deleted)).length,document.querySelector("#links_count").innerHTML=s.filter((e=>!e.deleted)).length;const n=k();(0,r.s)(e,n.parts,n.links),window.requestAnimationFrame((()=>{P(e)}))},I=()=>{(0,i.l)('\n    <div>\n      <p>Build and customize ships in the garage.</p>\n      <p>Big circles are for parts.</p>\n      <p>Small circles are for links.</p>\n      <p>Hover on a part and press a key to bind it. Press again to unbind.</p>\n    </div>\n    <canvas id="canvas"></canvas>\n    <div>\n      <p><select id="select_player_id">\n        <option value="0">Player 1</option>\n        <option value="1">Player 2</option>\n      </select></p>\n      <p><select id="select_kind">\n        <option value="armor">Armor</option>\n        <option value="booster">Booster</option>\n        <option value="core">Core</option>\n      </select></p>\n      <p>Parts: <span id="parts_count">...</span></p>\n      <p>Links: <span id="links_count">...</span></p>\n      <p><button id="go_button">Let\'s Go</button></p>\n      \x3c!--<button id="reset_button">Reset</button>\n      <button id="save_button">Save</button>--\x3e\n    </div>\n  '),(0,i.z)("\n    * {\n      color: #ffa;\n      background: transparent;\n    }\n    #content {\n      display: flex;\n      width: 100%;\n      height: 100%;\n      align-content: center;\n      align-items: center;\n      flex-direction: row;\n    }\n    button {\n      border: none;\n      padding: 0.8rem;\n      background: #fff1;\n    }\n    button:hover {\n      cursor: pointer;\n      background: #fff2;\n    }\n    #content > div {\n      width: 0;\n      flex-grow: 1;\n    }\n    p {\n      text-align: center;\n      color: #ffa;\n      font-family: monospace;\n      margin: 2rem;\n    }\n    #canvas {\n        background: #113;\n        display:flex;\n        position: unset;\n        cursor: none;\n    }\n    body {\n      background: #113;\n    }\n    select {\n      border: none;\n      background: #fff2;\n      padding: 0.8rem;\n    }\n  ");const e=document.querySelector("#canvas");e.addEventListener("click",(e=>{const n=(e.x-e.target.offsetLeft)/e.target.width,t=1-(e.y-e.target.offsetTop)/e.target.height;for(let e of d)if(u({x:n,y:t},e)){if(e.deleted=!e.deleted,e.deleted)for(var i of e.links)s[i.link_idx].deleted=!0;else m(e),e.kind=document.querySelector("#select_kind").value,e.player_id=document.querySelector("#select_player_id").value;return void x()}for(let e of p)if(u({x:n,y:t},e))return f(e.p.x,e.p.y,0,0,document.querySelector("#select_kind").value,document.querySelector("#select_player_id").value),void x()})),e.addEventListener("mousemove",(e=>{const n=(e.x-e.target.offsetLeft)/e.target.width,t=1-(e.y-e.target.offsetTop)/e.target.height;w.x=n,w.y=t})),document.addEventListener("keydown",(e=>{for(let n of d)u(w,n)&&(n.binding===e.key?n.binding=null:n.binding=e.key)})),document.querySelector("#go_button").addEventListener("click",(()=>{v(),window.location.href=".."}));const n=e.getContext("2d");(0,a.hU)(e),P(n);const t=JSON.parse(localStorage.getItem("ship")),r=t.DIAM/g;if(t&&t.parts.length){for(let e of t.parts)d.push({idx:d.length,p:{x:(e.p.x-t.center.x)/r+.5,y:(e.p.y-t.center.y)/r+.5},d:e.d/r,kind:e.kind,binding:e.binding,player_id:e.player_id,links:new Set,direction:{x:0,y:0}});for(let e of t.links)_(e.a,e.b)}else f(.5,.5,0,0,"core");x()}},640:(e,n,t)=>{"use strict";function i(){document.getElementById("content").innerHTML='<a href="/playground">Playground</a>\n<a href="/gallery">Gallery</a>\n<a href="/webgpu">webgpu</a>\n<a href="/localhost_3d">3D</a>\n'}t.d(n,{L:()=>i})},356:(e,n,t)=>{"use strict";t.d(n,{D:()=>M});var i=t(250),r=t(45),a=t(737),o=t(603),d=t(654);const s=[],l=[],p=new Map,c=[],u=[],f=(e,n,t=1)=>(0,o.uE)(e,n.p)<n.d*n.d*.25*t,_=(e,n,t,i,r,a,o=y)=>{const d=s.length;return s.push({idx:d,kind:r,d:o,p:{x:e,y:n},player_id:a,links:new Set,direction:{x:0,y:0}}),g(s[d]),d},m=(e,n)=>{const t=e<n?`${e}|${n}`:`${n}|${e}`;let i=s[e],r=s[n];if(p.has(t))return p.get(t);{const a=l.length;return l.push({idx:a,a:e,b:n,d:.5*y,p:{x:.5*(i.p.x+r.p.x),y:.5*(i.p.y+r.p.y)}}),p.set(t,a),s[e].links.add({part_idx:n,link_idx:a}),s[n].links.add({part_idx:e,link_idx:a}),a}},g=e=>{const n=(0,o.IH)(e.p,{x:1*y,y:0});for(var t=0;t<6;t++){const i=(0,o.U1)(e.p,n,t/6);for(let n of s)if(f(i,n)&&!n.deleted){const t=m(e.idx,n.idx);l[t].deleted=!1}}},y=.04,h=(e,n,t=y)=>{for(let t of c)if(f({x:e,y:n},t))return;const i=c.length;c.push({idx:i,d:t,p:{x:e,y:n},kind:"option"})},b=(e,n,t=y)=>{for(let t of u)if(f({x:e,y:n},t))return;const i=[],r=(0,o.IH)({x:e,y:n},{x:.5*y,y:0});for(var a=0;a<6;a++){const t=(0,o.U1)({x:e,y:n},r,a/6);for(let e of s)!e.deleted&&f(t,e,.2)&&i.push(e.idx)}if(2!=i.length)return;const d=u.length;u.push({idx:d,d:t,p:{x:e,y:n},kind:"link-option"})},x=e=>{const n=(0,o.IH)(e.p,{x:y,y:0}),t=(0,o.IH)(e.p,{x:.5*y,y:0});for(var i=0;i<6;i++){const r=(0,o.U1)(e.p,n,i/6);h(r.x,r.y);const a=(0,o.U1)(e.p,t,i/6);b(a.x,a.y,.5*y)}},w=()=>{c.length=0,u.length=0;for(let e of s)e.deleted||x(e);k()},v={x:-1,y:-1},k=()=>{localStorage.setItem("ship_journey",JSON.stringify(P(S()))),console.log("Ship saved")},S=()=>{const e=JSON.parse(JSON.stringify(l)),n=JSON.parse(JSON.stringify(s));let t=0;for(let e of n)e.deleted||(n[e.idx].idx_mieux=t,t+=1);const i=[],r=[];for(let e of n)e.deleted||i.push({p:{x:.25*(e.p.x-.5)+.8,y:.25*(e.p.y-.5)+.8},d:.25*e.d,np:{x:.25*(e.p.x-.5)+.8,y:.25*(e.p.y-.5)+.8},player_id:e.player_id,kind:e.kind,binding:e.binding});for(let t of e)t.deleted||r.push({a:n[t.a].idx_mieux,b:n[t.b].idx_mieux});return{links:r,parts:i,center:{x:.8,y:.8},DIAM:.25*y}},P=e=>{const n=JSON.parse(JSON.stringify(e));for(let e of n.parts)delete e.np;return n},I=e=>{(0,r.H)(e,s,c,u,v,l),document.querySelector("#parts_count").innerHTML=s.filter((e=>!e.deleted)).length,document.querySelector("#links_count").innerHTML=l.filter((e=>!e.deleted)).length;const n=S();(0,r.s)(e,n.parts,n.links),window.requestAnimationFrame((()=>{I(e)}))},M=()=>{(0,i.l)('\n    <div>\n      <p>Build and customize ships in the garage.</p>\n      <p>Big circles are for parts.</p>\n      <p>Small circles are for links.</p>\n      <p>Hover on a part and press a key to bind it. Press again to unbind.</p>\n    </div>\n    <canvas id="canvas"></canvas>\n    <div>\n      <p><select id="select_kind">\n        <option value="armor">Armor</option>\n        <option value="booster">Booster</option>\n        <option value="core">Core</option>\n      </select></p>\n      <p>Parts: <span id="parts_count">...</span></p>\n      <p>Links: <span id="links_count">...</span></p>\n      <p><button id="go_button">Let\'s Go</button></p>\n    </div>\n  '),(0,i.z)("\n    * {\n      color: #ffa;\n      background: transparent;\n    }\n    #content {\n      display: flex;\n      width: 100%;\n      height: 100%;\n      align-content: center;\n      align-items: center;\n      flex-direction: row;\n    }\n    button {\n      border: none;\n      padding: 0.8rem;\n      background: #fff1;\n    }\n    button:hover {\n      cursor: pointer;\n      background: #fff2;\n    }\n    #content > div {\n      width: 0;\n      flex-grow: 1;\n    }\n    p {\n      text-align: center;\n      color: #ffa;\n      font-family: monospace;\n      margin: 2rem;\n    }\n    #canvas {\n        background: #113;\n        display:flex;\n        position: unset;\n        cursor: none;\n    }\n    body {\n      background: #113;\n    }\n    select {\n      border: none;\n      background: #fff2;\n      padding: 0.8rem;\n    }\n  ");const e=document.querySelector("#canvas");e.addEventListener("click",(e=>{const n=(e.x-e.target.offsetLeft)/e.target.width,t=1-(e.y-e.target.offsetTop)/e.target.height;for(let e of s)if(f({x:n,y:t},e)){if(e.deleted=!e.deleted,e.deleted)for(var i of e.links)l[i.link_idx].deleted=!0;else g(e),e.kind=document.querySelector("#select_kind").value,e.player_id=0;return void w()}for(let e of c)if(f({x:n,y:t},e))return _(e.p.x,e.p.y,0,0,document.querySelector("#select_kind").value,0),void w()})),e.addEventListener("mousemove",(e=>{const n=(e.x-e.target.offsetLeft)/e.target.width,t=1-(e.y-e.target.offsetTop)/e.target.height;v.x=n,v.y=t})),document.addEventListener("keydown",(e=>{for(let n of s)f(v,n)&&(n.binding===e.key?n.binding=null:n.binding=e.key);k()})),document.querySelector("#go_button").addEventListener("click",(()=>{k(),window.location.href="/journey"}));const n=e.getContext("2d");(0,a.hU)(e),I(n);let t=JSON.parse(localStorage.getItem("ship_journey"));t=t||JSON.parse(d.bc);const r=t.DIAM/y;if(t&&t.parts.length){for(let e of t.parts)s.push({idx:s.length,p:{x:(e.p.x-t.center.x)/r+.5,y:(e.p.y-t.center.y)/r+.5},d:e.d/r,kind:e.kind,binding:e.binding,player_id:e.player_id,links:new Set,direction:{x:0,y:0}});for(let e of t.links)m(e.a,e.b)}else _(.5,.5,0,0,"core");w()}},370:(e,n,t)=>{"use strict";t.d(n,{S:()=>J});var i=t(737),r=t(189),a=t(603),o=t(467),d=t(654);const s=20,l=.0125;let p,c,u=[0,0],f=!0;const _=e=>{function n(e,n){return("00"+e).slice(-(n=n||2))}var t=e%1e3,i=(e=(e-t)/1e3)%60,r=(e=(e-i)/60)%60;return n((e-r)/60)+":"+n(r)+":"+n(i)+"."+n(t,3)},m=e=>{const n=`best_${parseInt(window.location.pathname.split("journey-")[1])}_${e}`;let t=localStorage.getItem(n);return t&&t.length&&(t=JSON.parse(t)),t&&t.id||(t={}),t.id=n,t},g=()=>{const e=`best_${parseInt(window.location.pathname.split("journey-")[1])}`;let n=localStorage.getItem(e);return n&&n.length&&(n=JSON.parse(n)),n&&n.id||(n={}),n.id=e,n},y=()=>localStorage.getItem("player_journey_name")?localStorage.getItem("player_journey_name"):"Blue",h=()=>{localStorage.setItem("player_journey_name",document.querySelector("#player_journey_name").value);const e=m(y()),n=e.duration?_(e.duration):"--:--:--:---";document.querySelector("#best_duration_current_player").innerHTML=n},b=e=>parseInt(e.y*s)%s*s+parseInt(e.x*s)%s,x=(e,n)=>n%s*s+e%s,w=[],v=[];for(var k=0;k<s;k++)for(var S=0;S<s;S++){const e=[(k-1+s)%s,(k+s)%s,(k+1+s)%s],n=[(S-1+s)%s,(S+s)%s,(S+1+s)%s],t=x(k,S);w.push([]),w[t]=[x(e[0],n[0]),x(e[0],n[1]),x(e[0],n[2]),x(e[1],n[0]),x(e[1],n[1]),x(e[1],n[2]),x(e[2],n[0]),x(e[2],n[1]),x(e[2],n[2])],v.push(new Set)}let P,I=[],M=new Set,U=[],E=new Set,z=new Map,B=[],O=!1;const T=e=>new Promise(e?n=>setTimeout(n,e):e=>e()),C=(e,n,t,i,r)=>{const a=I.length;return I.push({idx:a,kind:r,d:l,dp:{x:t,y:i},pp:{x:e-t,y:n-i},p:{x:e,y:n},np:{x:e,y:n},collision_response:{x:0,y:0,count:0},link_response:{x:0,y:0},links:new Set,direction:{x:0,y:0}}),a},G=(e,n,t)=>{const i=e<n?`${e}|${n}`:`${n}|${e}`;E.has(i)&&!t||(U.push({a:e,b:n}),E.add(i),I[e].links.add(n),I[n].links.add(e))},F=async(e,n,t)=>{const i=I.length,r=I.length+1;C(n-.00625,t,0,0,e.p1),await T(1),C(n+.00625,t,0,0,e.p2),await T(1);for(let n of e.parts){const e=I[i+n[0]],t=I[i+n[1]],r=(0,a.U1)(e.p,t.p,1/6),o=C(r.x,r.y,0,0,n[2]);G(o,e.idx),await T(1),G(o,t.idx),await T(1)}G(i,r),await T(1);for(let n of e.links)G(n[0]+i,n[1]+i),await T(1);for(let n of Object.keys(e.key_bindings)){z.has(n)||z.set(n,new Set);for(let t of e.key_bindings[n])z.get(n).add(t+i)}},H=e=>{(0,o.OZ)(),(0,i.ZH)(e);for(let n of I)n.deleted||(n.activated&&"booster"==n.kind?((0,i.FR)(e,(0,a.IH)(n.p,(0,a.dC)(n.direction,.007+.003*Math.random())),.7*n.d,r.O[n.kind].value_3),(0,i.FR)(e,(0,a.IH)(n.p,(0,a.dC)(n.direction,.005+.001*Math.random())),.9*n.d,r.O[n.kind].value_2),(0,i.FR)(e,n.p,n.d,r.O[n.kind].value_1)):"booster"==n.kind?(0,i.FR)(e,n.p,n.d,r.O[n.kind].value):(0,i.FR)(e,n.p,n.d,r.O[n.kind].value[n.player_id]));for(let n of Object.keys(r.O))for(let t of U){const o=I[t.a],d=I[t.b];if(o.deleted||d.deleted||t.deleted)continue;const s=(0,a.kG)(o.np,d.np),l=(0,a.dC)((0,a.pY)(s.a,s.b),.5),p=r.O[o.kind].score>r.O[d.kind].score?o.kind:d.kind;if(n==p){const n=r.O[p].value[o.player_id],t=.75;(0,i.FR)(e,(0,a.IH)(o.p,l),o.d*t,n),(0,i.FR)(e,(0,a.IV)(d.p,l),d.d*t,n)}}document.getElementById("fps").innerHTML=(0,o.e0)(),document.getElementById("ups").innerHTML=(0,o.gk)(),f?window.requestAnimationFrame((()=>{H(e)})):W()},L=e=>{const n=b(e);return new Set([...v[w[n][0]],...v[w[n][1]],...v[w[n][2]],...v[w[n][3]],...v[w[n][4]],...v[w[n][5]],...v[w[n][6]],...v[w[n][7]],...v[w[n][8]]])},$=()=>{(()=>{for(var e=0;e<400;e++)v[e].clear();for(let e of I){const n=b(e.p);v[n].add(e.idx),e.grid_id=n}})();let e=0;for(let n of I)if(!n.deleted){n.direction={x:0,y:0};for(let e of n.links){const t=I[e],i=(0,a.kG)(n.p,t.p);n.direction=(0,a.IH)(n.direction,(0,a.pY)(i.b,i.a))}n.direction=(0,a.Fv)(n.direction),n.dp.x=n.p.x-n.pp.x,n.dp.y=n.p.y-n.pp.y,"booster"==n.kind&&n.activated&&(n.dp.x-=1e-4*n.direction.x,n.dp.y-=1e-4*n.direction.y),n.np.x=n.p.x+n.dp.x,n.np.y=n.p.y+n.dp.y,n.link_response.x=0,n.link_response.y=0,n.collision_response.x=0,n.collision_response.y=0,n.collision_response.count=0,e+=(0,a.uE)(n.dp)}for(let e of I)if(!e.deleted)for(let n of L(e.p)){const t=I[n];if(!t.deleted&&e.idx<t.idx){const n=(0,a.kG)(e.np,t.np);n.a.np={x:n.a.x,y:n.a.y},n.b.np={x:n.b.x,y:n.b.y},n.a.dp=e.dp,n.b.dp=t.dp;const i=n.d_sqrd,r=.5*(e.d+t.d);if(i<r*r){let i=null,r=null;void 0!==e.player_id&&"emerald"==t.kind?(i=t.idx,r=e.player_id):void 0!==t.player_id&&"emerald"==e.kind&&(i=e.idx,r=t.player_id),i&&(I[i].deleted=!0,M.add(i),u[r]+=1);let o=(0,a.FF)(n.a,n.b);E.has(`${e.idx}|${t.idx}`)&&(o.x*=.5,o.y*=.5),e.collision_response.x-=o.x,e.collision_response.y-=o.y,e.collision_response.count+=1,t.collision_response.x+=o.x,t.collision_response.y+=o.y,t.collision_response.count+=1}}}for(let e of U){const n=I[e.a],t=I[e.b];if(n.deleted&&t.deleted&&(e.deleted=!0),n.deleted||t.deleted||e.deleted)continue;const i=(0,a.kG)(n.np,t.np),r=Math.sqrt(i.d_sqrd),o=(0,a.Fv)((0,a.pY)(i.a,i.b),r),d=.2*(.5*(n.d+t.d)-r);n.link_response.x-=o.x*d*.5,n.link_response.y-=o.y*d*.5,t.link_response.x+=o.x*d*.5,t.link_response.y+=o.y*d*.5}for(let e of I)e.deleted||(e.collision_response.count&&(e.collision_response.x/=e.collision_response.count,e.collision_response.y/=e.collision_response.count,e.np.x+=e.collision_response.x,e.np.y+=e.collision_response.y,e.np.x+=e.link_response.x,e.np.y+=e.link_response.y),e.p.x=(e.np.x+1)%1,e.p.y=(e.np.y+1)%1,e.pp.x=e.p.x-e.dp.x-e.collision_response.x-e.link_response.x,e.pp.y=e.p.y-e.dp.y-e.collision_response.y-e.link_response.y);(0,o.Ov)(),R(),window.setTimeout((()=>{$()}),10-(0,o.Xe)())},R=()=>{if(null!=P)return;let e;for(var n=0;n<u.length;n++)if(u[n]>=p){P=n,e=performance.now()-c;break}null!=P&&(localStorage.setItem("progress",parseInt(Math.max(parseInt(window.location.pathname.split("journey-")[1]),parseInt(localStorage.getItem("progress"))))),((e,n)=>{const t=g();t.duration&&t.duration<=e||(t.duration=e,t.player_name=n,localStorage.setItem(t.id,JSON.stringify(t)));const i=m(n);i.duration&&i.duration<=e||(i.duration=e,i.player_name=n,localStorage.setItem(i.id,JSON.stringify(i)))})(e,y()),document.querySelector("#duration").innerHTML=`${_(e)}`,document.querySelector("#winner").classList.remove("hide"))},A=()=>{if(M.size){const e=M.keys().next().value;if(!(e=>{for(var n of B)for(var t of n)if(e==t)return!0})(e))return M.delete(e),e}const e=I.length;return I.push({}),e},q=(e,n)=>{for(var t of(e||(e=.8*Math.random()+.1),n||(n=.8*Math.random()+.1),I))if((0,a.kG)(t.p,{x:e,y:n}).d_sqrd<l*l*4*4)return q();const i=new Set;for(var r=0;r<4;r++)i.add(A());return j(d.Bz,e,n,[...i]),i},j=(e,n,t,i)=>{const r=i[0],o=i[1];D(n-.00625,t,0,0,e.p1,i[0]),D(n+.00625,t,0,0,e.p2,i[1]);for(var d=0;d<e.parts.length;d++){const n=e.parts[d],t=I[i[n[0]]],r=I[i[n[1]]],o=(0,a.U1)(t.p,r.p,1/6),s=i[d+2];D(o.x,o.y,0,0,n[2],s),G(s,t.idx,!0),G(s,r.idx,!0)}G(r,o,!0);for(let n of e.links)G(i[n[0]],i[n[1]],!0);for(let n of Object.keys(e.key_bindings)){z.has(n)||z.set(n,new Set);for(let t of e.key_bindings[n])z.get(n).add(i[t])}},D=(e,n,t,i,r,a)=>(I[a]={idx:a,kind:r,d:l,dp:{x:t,y:i},pp:{x:e-t,y:n-i},p:{x:e,y:n},np:{x:e,y:n},collision_response:{x:0,y:0,count:0},link_response:{x:0,y:0},links:new Set,direction:{x:0,y:0}},a),N=()=>{f=!1},Y=()=>{const e=window.location.pathname.split("journey-")[1];window.location.pathname=`/journey-${parseInt(e)+1}`},W=async()=>{f=!0,I=[],M=new Set,U=[],E=new Set,z=new Map,B=[],O=!1,P=void 0,u=[-1,-1],document.querySelector("#content").innerHTML=(()=>{const e=g(),n=e.duration?_(e.duration):"--:--:--:---",t=e.player_name?e.player_name:"",i=m(y()),r=i.duration?_(i.duration):"--:--:--:---";return`\n    <div id="winner" class="hide">\n      <p><span id="duration"></span></p>\n      <div>\n        <button onclick="again()">Play Again<br>[space]</button>\n        <button onclick="next()">Next<br>[enter]</button>\n      </div>\n    </div>\n    <div class="bob">\n      <input class="player_name"  id="player_journey_name"\n        value="${y()}"\n        oninput="update_player_info()"></input>\n      <p class="disappearable disappear" id="best_duration_current_player">${r}</p>\n      <p id="move_with_instructions" class="disappearable disappear">Loading...</p>\n      <p class="disappearable disappear"> <a href="/journey">Levels</a> </p>\n      <p class="disappearable disappear"> <a href="/journey-garage">Garage</a> </p>\n    </div>\n    <canvas id="canvas"></canvas>\n    <div class="bob">\n      <p class="disappearable disappear" id="best_name">${t}</p>\n      <p class="disappearable disappear" id="best_duration">${n}</p>\n      <p class="disappearable disappear">FPS: <span id="fps">...</span></p>\n      <p class="disappearable disappear">UPS: <span id="ups">...</span></p>\n      <p class="disappearable disappear"> <a href="/">Home</a> </p>\n    </div>\n  `})();const e=document.createElement("style");document.head.appendChild(e);for(let n of"\n    * {\n      color: #ffa;\n      background: #113;\n      font-size: 1.05rem;\n    }\n    select {\n      border: none;\n    }\n    option {\n    }\n    #content {\n      display: flex;\n      width: 100%;\n      height: 100%;\n      align-content: center;\n      align-items: center;\n      flex-direction: row;\n    }\n    a {\n      color: #ffa;\n      text-decoration: none;\n      background-color: #fff0;\n      padding: 0.8rem;\n    }\n    .disappear, .disappear * {\n      color: #0000;\n      transition: color 0.2s;\n    }\n    a:hover {\n      background-color: #fff2;\n    }\n    #score_player_1, #score_player_2 {\n      font-size: 2rem;\n    }\n    #content > div.bob {\n      width: 0;\n      flex-grow: 1;\n      display: flex;\n      justify-content: space-around;\n      flex-direction: column;\n      height: 100%;\n    }\n    p {\n      text-align: center;\n      color: #ffa;\n      font-family: monospace;\n    }\n    p span {\n      color: #ffa;\n    }\n    #canvas {\n        background: #113;\n        display:flex;\n        position: unset;\n    }\n    body {\n      background: #113;\n    }\n    #winner {\n      position: absolute;\n      height: 100vh;\n      width: 100vw;\n      background: #0000;\n      display: flex;\n      flex-direction: column;\n      align-content: center;\n      align-items: center;\n      justify-content: center;\n      pointer-events: none;\n    }\n    #winner > p {\n      background: #ffaa;\n      padding: 5rem;\n      border-radius: 10rem;\n      border: solid 5px #ffa;\n    }\n    #winner > p > span, #winner > p  {\n      color: #ffa;\n      font-size: 3rem;\n    }\n    #winner > p > span {\n      background: transparent;\n    }\n    #winner button {\n      border: none;\n      margin: 2rem;\n      cursor: pointer;\n      pointer-events: all;\n      padding: 1rem;\n      border-radius: 10rem;\n      background: #fff0;\n      line-height: 1.5rem;\n    }\n    #winner div {\n      background: #fff0;\n    }\n    #winner button:hover {\n      background: #fff2;\n    }\n    .hide {\n      display: none !important;\n    }\n    a {\n      border-radius: 10rem;\n    }\n    .player_name {\n      text-align: center;\n      background: none;\n      border: solid 2px transparent;\n      margin-left: 1rem;\n      margin-right: 1rem;\n      padding: 0.5rem;\n      font-size: 1.5rem;\n    }\n    .player_name:hover {\n      border: solid 2px #ffdd;\n    }\n    #best_name {\n      margin-left: 1rem;\n      margin-right: 1rem;\n      padding: 0.5rem;\n      font-size: 1.5rem;\n      border: solid 2px #0000;\n    }\n  ".split("}"))try{e.sheet.insertRule(n+"}")}catch(e){}const n=document.querySelector("#canvas");(0,i.hU)(n);const t=n.getContext("2d"),r="2022.08.09";localStorage.getItem("ship_journey")&&localStorage.getItem("version")===r||(localStorage.setItem("ship_journey",d.bc),localStorage.setItem("version",r)),H(t),O=!1,await(async(e,n,t)=>{const i=I.length;for(let n of e.parts){const t=C((n.p.x-e.center.x)/e.DIAM*l+.5,(n.p.y-e.center.y)/e.DIAM*l+.5,0,0,n.kind);I[t].player_id=n.player_id,n.binding&&(z.has(n.binding)||z.set(n.binding,new Set),z.get(n.binding).add(t)),await T(1)}for(let n of e.links)G(n.a+i,n.b+i),await T(1)})(JSON.parse(localStorage.getItem("ship_journey")));const a=new Set;for(let e of z){const n=e[0],t=e[1];for(let e of t)"booster"==I[e].kind&&a.add(n)}const o=parseInt(window.location.pathname.split("journey-")[1]);0===o?(B.push(q(.5,.7)),B.push(q(.5,.3))):1===o?(await F(d.Hm,.27,.5),await F(d.Hm,.5,.27),await F(d.Hm,.73,.5),await F(d.Hm,.5,.73),await F(d.Hm,.8,.8),await F(d.Hm,.2,.8),await F(d.Hm,.8,.2),await F(d.Hm,.2,.2),B.push(q(.33,.33)),B.push(q(.67,.33)),B.push(q(.33,.67)),B.push(q(.67,.67))):2===o?(B.push(q(.27,.5)),B.push(q(.5,.27)),B.push(q(.73,.5)),B.push(q(.5,.73)),B.push(q(.8,.8)),B.push(q(.8,.2)),B.push(q(.2,.8)),B.push(q(.2,.2)),B.push(q(.33,.33)),B.push(q(.67,.33)),B.push(q(.33,.67)),B.push(q(.67,.67))):3===o?(B.push(q(.27,.5)),B.push(q(.73,.5)),B.push(q(.8,.5)),B.push(q(.2,.5)),B.push(q(.33,.5)),B.push(q(.67,.5))):4===o?(B.push(q(.27,.5)),B.push(q(.5,.27)),B.push(q(.73,.5)),B.push(q(.5,.73)),B.push(q(.8,.8)),B.push(q(.2,.8)),B.push(q(.8,.2)),B.push(q(.2,.2)),await F(d.Hm,.33,.33),await F(d.Hm,.67,.33),await F(d.Hm,.33,.67),await F(d.Hm,.67,.67)):(B.push(q()),B.push(q()),B.push(q()),B.push(q())),parseInt(localStorage.getItem("progress"))>=o-1&&o<=4?(console.log("ok"),u[0]=0):console.log("not ok"),a.size&&(document.querySelector("#move_with_instructions").innerHTML=`Move with ${Array.from(a).map((e=>e.toUpperCase())).join(", ")}`),O=!0,p=I.filter((e=>"emerald"==e.kind)).length,c=performance.now()},J=async e=>{window.again=N,window.next=Y,window.update_player_info=h,document.addEventListener("keydown",(e=>{if(z.get(e.key)){if(O){document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.add("disappear")}));for(let n of z.get(e.key))I[n].activated=!0}}else" "!=e.key?"Enter"!=e.key?document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.remove("disappear")})):O&&void 0!==P&&Y():O&&N()})),document.addEventListener("keyup",(e=>{if(z.get(e.key))for(let n of z.get(e.key))I[n].activated=!1})),document.addEventListener("mousemove",(e=>{document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.remove("disappear")}))})),W(),$(),document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.remove("disappear")}))}},593:(e,n,t)=>{"use strict";t.d(n,{E:()=>r}),localStorage.getItem("progress")||localStorage.setItem("progress",0);const i=localStorage.getItem("progress"),r=()=>{document.querySelector("#content").innerHTML=`\n    <div class="bob">\n      <p> <a href="/">Home</a> </p>\n\n    </div>\n\n    <div id="levels">\n      ${(()=>{const e=[];for(var n=0;n<2;n++){const r=[];for(var t=0;t<2;t++){const e=2*n+t;r.push({locked:e>i?"locked":"",idx:e,label:(2*n+t+1).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})})}e.push(r.map((e=>e.locked?`<p class="level_link locked">${e.label}</p>`:`<a class="level_link" href="journey-${e.idx+1}">${e.label}</a>`)).join(""))}return e.map((e=>`<div class="line">${e}</div>`)).join("")})()}\n    </div>\n\n    <div class="bob">\n    \x3c!--  <p> <a href="/leaderboard">Leaderboard</a> </p>--\x3e\n      <p> <a href="/journey-garage">Garage</a> </p>\n    </div>\n  `;const e=document.createElement("style");document.head.appendChild(e);for(let n of"\n    #levels > * {\n      flex-grow: 1;\n    }\n    * {\n      color: #ffa;\n      background: #113;\n      font-size: 1.05rem;\n    }\n    select {\n      border: none;\n    }\n    option {\n    }\n    #content {\n      display: flex;\n      width: 100%;\n      height: 100%;\n      align-content: center;\n      align-items: center;\n      flex-direction: row;\n    }\n    a, .level_link {\n      color: #ffa;\n      text-decoration: none;\n      background-color: #fff0;\n      padding: 0.8rem;\n    }\n    .level_link.locked {\n      color: #aaa;\n    }\n    a:hover {\n      background-color: #fff2;\n    }\n    #score_player_1, #score_player_2 {\n      font-size: 2rem;\n    }\n    #content > div.bob {\n      width: 0;\n      flex-grow: 1;\n      display: flex;\n      justify-content: space-around;\n      flex-direction: column;\n      height: 100%;\n    }\n    p {\n      text-align: center;\n      color: #ffa;\n      font-family: monospace;\n    }\n    p span {\n      color: #ffa;\n    }\n    #canvas {\n        background: #113;\n        display:flex;\n        position: unset;\n    }\n    body {\n      background: #113;\n    }\n    a {\n      padding: 2rem;\n      border-radius: 10rem;\n    }\n    #levels {\n      display: flex;\n      flex-wrap: wrap;\n      align-content: center;\n      align-items: center;\n      flex-direction: column;\n      justify-content: space-around;\n      justify-items: stretch;\n      flex-flow: column wrap;\n      place-content: center space-around;\n      place-items: center;\n      padding: 1rem;\n      flex-direction: column;\n      justify-content: space-around;\n      padding: 1rem;\n    }\n    #levels > * {\n      flex-grow: 1;\n      display: flex;\n      flex-direction: row;\n      align-content: center;\n      align-items: center;\n      display: flex;\n      flex-direction: row;\n      align-content: center;\n      align-items: center;\n    }\n  ".split("}"))try{e.sheet.insertRule(n+"}")}catch(e){}}},760:(e,n,t)=>{"use strict";t.d(n,{Z:()=>q});var i=t(737),r=t(189),a=t(603),o=t(467),d=t(654);const s=20,l=.0125;let p=[0,0],c=!0;const u=()=>{const e=document.querySelector("#select_mode").value;localStorage.setItem("select_mode_option",e),R()},f=()=>{const e=document.querySelector("#select_arena").value;localStorage.setItem("select_arena_option",e),R()},_=e=>parseInt(e.y*s)%s*s+parseInt(e.x*s)%s,m=(e,n)=>n%s*s+e%s,g=[],y=[];for(var h=0;h<s;h++)for(var b=0;b<s;b++){const e=[(h-1+s)%s,(h+s)%s,(h+1+s)%s],n=[(b-1+s)%s,(b+s)%s,(b+1+s)%s],t=m(h,b);g.push([]),g[t]=[m(e[0],n[0]),m(e[0],n[1]),m(e[0],n[2]),m(e[1],n[0]),m(e[1],n[1]),m(e[1],n[2]),m(e[2],n[0]),m(e[2],n[1]),m(e[2],n[2])],y.push(new Set)}let x,w=[],v=new Set,k=[],S=new Set,P=new Map,I=[],M=!1;const U=e=>new Promise(e?n=>setTimeout(n,e):e=>e()),E=(e,n,t,i,r)=>{const a=w.length;return w.push({idx:a,kind:r,d:l,dp:{x:t,y:i},pp:{x:e-t,y:n-i},p:{x:e,y:n},np:{x:e,y:n},collision_response:{x:0,y:0,count:0},link_response:{x:0,y:0},links:new Set,direction:{x:0,y:0}}),a},z=(e,n,t)=>{const i=e<n?`${e}|${n}`:`${n}|${e}`;S.has(i)&&!t||(k.push({a:e,b:n}),S.add(i),w[e].links.add(n),w[n].links.add(e))},B=async(e,n,t)=>{const i=w.length,r=w.length+1;E(n-.00625,t,0,0,e.p1),await U(1),E(n+.00625,t,0,0,e.p2),await U(1);for(let n of e.parts){const e=w[i+n[0]],t=w[i+n[1]],r=(0,a.U1)(e.p,t.p,1/6),o=E(r.x,r.y,0,0,n[2]);z(o,e.idx),await U(1),z(o,t.idx),await U(1)}z(i,r),await U(1);for(let n of e.links)z(n[0]+i,n[1]+i),await U(1);for(let n of Object.keys(e.key_bindings)){P.has(n)||P.set(n,new Set);for(let t of e.key_bindings[n])P.get(n).add(t+i)}},O=e=>{(0,o.OZ)(),(0,i.ZH)(e);for(let n of w)n.deleted||(n.activated&&"booster"==n.kind?((0,i.FR)(e,(0,a.IH)(n.p,(0,a.dC)(n.direction,.007+.003*Math.random())),.7*n.d,r.O[n.kind].value_3),(0,i.FR)(e,(0,a.IH)(n.p,(0,a.dC)(n.direction,.005+.001*Math.random())),.9*n.d,r.O[n.kind].value_2),(0,i.FR)(e,n.p,n.d,r.O[n.kind].value_1)):"booster"==n.kind?(0,i.FR)(e,n.p,n.d,r.O[n.kind].value):(0,i.FR)(e,n.p,n.d,r.O[n.kind].value[n.player_id]));for(let n of Object.keys(r.O))for(let t of k){const o=w[t.a],d=w[t.b];if(o.deleted||d.deleted||t.deleted)continue;const s=(0,a.kG)(o.np,d.np),l=(0,a.dC)((0,a.pY)(s.a,s.b),.5),p=r.O[o.kind].score>r.O[d.kind].score?o.kind:d.kind;if(n==p){const n=r.O[p].value[o.player_id],t=.75;(0,i.FR)(e,(0,a.IH)(o.p,l),o.d*t,n),(0,i.FR)(e,(0,a.IV)(d.p,l),d.d*t,n)}}document.getElementById("fps").innerHTML=(0,o.e0)(),document.getElementById("ups").innerHTML=(0,o.gk)(),document.getElementById("score_player_1").innerHTML=p[0],document.getElementById("score_player_2").innerHTML=p[1],c?window.requestAnimationFrame((()=>{O(e)})):A()},T=e=>{const n=_(e);return new Set([...y[g[n][0]],...y[g[n][1]],...y[g[n][2]],...y[g[n][3]],...y[g[n][4]],...y[g[n][5]],...y[g[n][6]],...y[g[n][7]],...y[g[n][8]]])},C=()=>{(()=>{for(var e=0;e<400;e++)y[e].clear();for(let e of w){const n=_(e.p);y[n].add(e.idx),e.grid_id=n}})();let e=0;for(let n of w)if(!n.deleted){n.direction={x:0,y:0};for(let e of n.links){const t=w[e],i=(0,a.kG)(n.p,t.p);n.direction=(0,a.IH)(n.direction,(0,a.pY)(i.b,i.a))}n.direction=(0,a.Fv)(n.direction),n.dp.x=n.p.x-n.pp.x,n.dp.y=n.p.y-n.pp.y,"booster"==n.kind&&n.activated&&(n.dp.x-=1e-4*n.direction.x,n.dp.y-=1e-4*n.direction.y),n.np.x=n.p.x+n.dp.x,n.np.y=n.p.y+n.dp.y,n.link_response.x=0,n.link_response.y=0,n.collision_response.x=0,n.collision_response.y=0,n.collision_response.count=0,e+=(0,a.uE)(n.dp)}for(let e of w)if(!e.deleted)for(let n of T(e.p)){const t=w[n];if(!t.deleted&&e.idx<t.idx){const n=(0,a.kG)(e.np,t.np);n.a.np={x:n.a.x,y:n.a.y},n.b.np={x:n.b.x,y:n.b.y},n.a.dp=e.dp,n.b.dp=t.dp;const i=n.d_sqrd,r=.5*(e.d+t.d);if(i<r*r){let i=null,r=null;void 0!==e.player_id&&"emerald"==t.kind?(i=t.idx,r=e.player_id):void 0!==t.player_id&&"emerald"==e.kind&&(i=e.idx,r=t.player_id),i&&(w[i].deleted=!0,v.add(i),p[r]+=1);let o=(0,a.FF)(n.a,n.b);S.has(`${e.idx}|${t.idx}`)&&(o.x*=.5,o.y*=.5),e.collision_response.x-=o.x,e.collision_response.y-=o.y,e.collision_response.count+=1,t.collision_response.x+=o.x,t.collision_response.y+=o.y,t.collision_response.count+=1}}}for(let e of k){const n=w[e.a],t=w[e.b];if(n.deleted&&t.deleted&&(e.deleted=!0),n.deleted||t.deleted||e.deleted)continue;const i=(0,a.kG)(n.np,t.np),r=Math.sqrt(i.d_sqrd),o=(0,a.Fv)((0,a.pY)(i.a,i.b),r),d=.2*(.5*(n.d+t.d)-r);n.link_response.x-=o.x*d*.5,n.link_response.y-=o.y*d*.5,t.link_response.x+=o.x*d*.5,t.link_response.y+=o.y*d*.5}for(let e of w)e.deleted||(e.collision_response.count&&(e.collision_response.x/=e.collision_response.count,e.collision_response.y/=e.collision_response.count,e.np.x+=e.collision_response.x,e.np.y+=e.collision_response.y,e.np.x+=e.link_response.x,e.np.y+=e.link_response.y),e.p.x=(e.np.x+1)%1,e.p.y=(e.np.y+1)%1,e.pp.x=e.p.x-e.dp.x-e.collision_response.x-e.link_response.x,e.pp.y=e.p.y-e.dp.y-e.collision_response.y-e.link_response.y);for(var n=0;n<I.length;n++){const e=I[n];let i=0;for(var t of e)w[t].deleted&&(i+=1);4===i&&(I[n]=H())}(0,o.Ov)(),G(),window.setTimeout((()=>{C()}),10-(0,o.Xe)())},G=()=>{if(null!=x)return;let e=1/0;"first_16"==document.querySelector("#select_mode").value?e=16:"first_32"==document.querySelector("#select_mode").value&&(e=32);for(var n=0;n<p.length;n++)p[n]>=e&&(x=n);null!=x&&(document.querySelector("#winner").classList.remove("hide"),document.querySelector("#winner_name").innerHTML={0:document.querySelector("#player_1_name").value,1:document.querySelector("#player_2_name").value}[x])},F=()=>{if(v.size){const e=v.keys().next().value;if(!(e=>{for(var n of I)for(var t of n)if(e==t)return!0})(e))return v.delete(e),e}const e=w.length;return w.push({}),e},H=(e,n)=>{for(var t of(e||(e=.8*Math.random()+.1),n||(n=.8*Math.random()+.1),w))if((0,a.kG)(t.p,{x:e,y:n}).d_sqrd<l*l*4*4)return H();const i=new Set;for(var r=0;r<4;r++)i.add(F());return L(d.Bz,e,n,[...i]),i},L=(e,n,t,i)=>{const r=i[0],o=i[1];$(n-.00625,t,0,0,e.p1,i[0]),$(n+.00625,t,0,0,e.p2,i[1]);for(var d=0;d<e.parts.length;d++){const n=e.parts[d],t=w[i[n[0]]],r=w[i[n[1]]],o=(0,a.U1)(t.p,r.p,1/6),s=i[d+2];$(o.x,o.y,0,0,n[2],s),z(s,t.idx,!0),z(s,r.idx,!0)}z(r,o,!0);for(let n of e.links)z(i[n[0]],i[n[1]],!0);for(let n of Object.keys(e.key_bindings)){P.has(n)||P.set(n,new Set);for(let t of e.key_bindings[n])P.get(n).add(i[t])}},$=(e,n,t,i,r,a)=>(w[a]={idx:a,kind:r,d:l,dp:{x:t,y:i},pp:{x:e-t,y:n-i},p:{x:e,y:n},np:{x:e,y:n},collision_response:{x:0,y:0,count:0},link_response:{x:0,y:0},links:new Set,direction:{x:0,y:0}},a),R=()=>{c=!1},A=async()=>{c=!0,w=[],v=new Set,k=[],S=new Set,P=new Map,I=[],M=!1,x=void 0,p=[0,0],document.querySelector("#content").innerHTML=`\n    <div id="winner" class="hide">\n      <p><span id="winner_name">..</span> Wins!</p>\n      <button onclick="again()">Play Again<br>[space]</button>\n    </div>\n    <div class="bob">\n      <input class="player_name"  id="player_1_name"\n        value="${localStorage.getItem("player_1_name")?localStorage.getItem("player_1_name"):"Blue"}"\n        oninput="localStorage.setItem('player_1_name', document.querySelector('#player_1_name').value)"></input>\n      <p><span id="score_player_1"></span></p>\n      <p id="move_with_instructions" class="disappearable disappear">Loading...</p>\n      <p class="disappearable disappear"> <a href="garage">Go to Garage</a> </p>\n      <p class="disappearable disappear"> <a href="journey">Journey</a> </p>\n      <p class="disappearable disappear"> <a href="https://github.com/loicbourgois/gravitle">Github</a> </p>\n    </div>\n    <canvas id="canvas"></canvas>\n    <div class="bob">\n      <input class="player_name"  id="player_2_name"\n        value="${localStorage.getItem("player_2_name")?localStorage.getItem("player_2_name"):"Green"}"\n        oninput="localStorage.setItem('player_2_name', document.querySelector('#player_2_name').value)"></input>\n      <p><span id="score_player_2"></span></p>\n      <p class="disappearable disappear">${(()=>{const e=localStorage.getItem("select_mode_option"),n=[{value:"first_16",text:"First to 16"},{value:"first_32",text:"First to 32"}].map((n=>`<option value=${n.value} ${n.value==e?"selected":""}>${n.text}</option>`));return`<select id="select_mode" onchange="update_select_mode_option()">\n    ${n}\n  </select>`})()}</p>\n      <p class="disappearable disappear">${(()=>{const e=localStorage.getItem("select_arena_option"),n=[{value:"octo",text:"Octo"},{value:"empty",text:"Empty"}].map((n=>`<option value=${n.value} ${n.value==e?"selected":""}>${n.text}</option>`));return`<select id="select_arena" onchange="update_select_arena_option()">\n    ${n}\n  </select>`})()}</p>\n      <p class="disappearable disappear">FPS: <span id="fps">...</span></p>\n      <p class="disappearable disappear">UPS: <span id="ups">...</span></p>\n    </div>\n  `;const e=document.createElement("style");document.head.appendChild(e);for(let n of"\n    * {\n      color: #ffa;\n      background: #113;\n      font-size: 1.05rem;\n    }\n    select {\n      border: none;\n    }\n    option {\n    }\n    #content {\n      display: flex;\n      width: 100%;\n      height: 100%;\n      align-content: center;\n      align-items: center;\n      flex-direction: row;\n    }\n    a {\n      color: #ffa;\n      text-decoration: none;\n      background-color: #fff0;\n      padding: 0.8rem;\n    }\n    .disappear, .disappear * {\n      color: #0000;\n      transition: color 0.2s;\n    }\n    a:hover {\n      background-color: #fff2;\n    }\n    #score_player_1, #score_player_2 {\n      font-size: 2rem;\n    }\n    #content > div.bob {\n      width: 0;\n      flex-grow: 1;\n      display: flex;\n      justify-content: space-around;\n      flex-direction: column;\n      height: 100%;\n    }\n    p {\n      text-align: center;\n      color: #ffa;\n      font-family: monospace;\n    }\n    p span {\n      color: #ffa;\n    }\n    #canvas {\n        background: #113;\n        display:flex;\n        position: unset;\n    }\n    body {\n      background: #113;\n    }\n    #winner {\n      position: absolute;\n      height: 100vh;\n      width: 100vw;\n      background: #0000;\n      display: flex;\n      flex-direction: column;\n      align-content: center;\n      align-items: center;\n      justify-content: center;\n      pointer-events: none;\n    }\n    #winner > p {\n      background: #ffaa;\n      padding: 5rem;\n      border-radius: 10rem;\n      border: solid 5px #ffa;\n    }\n    #winner > p > span, #winner > p  {\n      color: #ffa;\n      font-size: 3rem;\n    }\n    #winner > p > span {\n      background: transparent;\n    }\n    #winner > button {\n      border: none;\n      margin: 2rem;\n      cursor: pointer;\n      pointer-events: all;\n      padding: 1rem;\n      border-radius: 10rem;\n      background: #fff0;\n      line-height: 1.5rem;\n    }\n    #winner > button:hover {\n      background: #fff2;\n    }\n    .hide {\n      display: none !important;\n    }\n    a {\n      border-radius: 10rem;\n    }\n    .player_name {\n      text-align: center;\n      background: none;\n      border: solid 2px transparent;\n      margin-left: 1rem;\n      margin-right: 1rem;\n      padding: 0.5rem;\n      font-size: 1.5rem;\n    }\n    .player_name:hover {\n      border: solid 2px #ffdd;\n    }\n  ".split("}"))try{e.sheet.insertRule(n+"}")}catch(e){}const n=document.querySelector("#canvas");(0,i.hU)(n);const t=n.getContext("2d"),r="2022.08.09";localStorage.getItem("ship")&&localStorage.getItem("version")===r||(localStorage.setItem("ship",d.lX),localStorage.setItem("version",r)),O(t),M=!1,await(async(e,n,t)=>{const i=w.length;for(let n of e.parts){const t=E((n.p.x-e.center.x)/e.DIAM*l+.5,(n.p.y-e.center.y)/e.DIAM*l+.5,0,0,n.kind);w[t].player_id=n.player_id,n.binding&&(P.has(n.binding)||P.set(n.binding,new Set),P.get(n.binding).add(t)),await U(1)}for(let n of e.links)z(n.a+i,n.b+i),await U(1)})(JSON.parse(localStorage.getItem("ship")));const a=new Set;for(let e of P){const n=e[0],t=e[1];for(let e of t)"booster"==w[e].kind&&a.add(n)}"octo"==document.querySelector("#select_arena").value&&(await B(d.Hm,.27,.5),await B(d.Hm,.5,.27),await B(d.Hm,.73,.5),await B(d.Hm,.5,.73),await B(d.Hm,.8,.8),await B(d.Hm,.2,.8),await B(d.Hm,.8,.2),await B(d.Hm,.2,.2)),a.size&&(document.querySelector("#move_with_instructions").innerHTML=`Move with ${Array.from(a).map((e=>e.toUpperCase())).join(", ")}`),I.push(H()),I.push(H()),M=!0},q=async()=>{window.update_select_mode_option=u,window.update_select_arena_option=f,window.again=R,document.addEventListener("keydown",(e=>{if(P.get(e.key)){if(M){document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.add("disappear")}));for(let n of P.get(e.key))w[n].activated=!0}}else" "!=e.key?document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.remove("disappear")})):null!=x&&M&&R()})),document.addEventListener("keyup",(e=>{if(P.get(e.key))for(let n of P.get(e.key))w[n].activated=!1})),document.addEventListener("mousemove",(e=>{document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.remove("disappear")}))})),A(),C(),document.querySelectorAll(".disappearable").forEach(((e,n)=>{e.classList.remove("disappear")}))}},36:(e,n,t)=>{"use strict";t.d(n,{z:()=>s}),t(411),t(162);var i=t(212),r=t(980),a=t(291);function o(e){console.log("starting");const n=new i.cPb(e.fov,window.innerWidth/window.innerHeight,e.clipping.near,e.clipping.far);n.position.x=.5,n.position.y=.5,n.position.z=.5;const t=new i.CP7;t.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(t.domElement);const r=new i.xsS,a=new i.cek(16777215,.8,100);a.position.set(n.position.x,n.position.y,n.position.z),r.add(a);const o=document.getElementById("minimap");o.width=e.image_width,o.height=e.image_height;const s=o.getContext("2d");d({scene:r,renderer:t,camera:n,minimap:o,ctx_minimap:s,pull:e.pull,fps_counter:[],fps_counter_length:100,materials:{default:new i.YBo({color:15658496})},meshes:[]})}function d(e){requestAnimationFrame((function(){d(e)}));const n=performance.now();e.camera.rotation.y+=3e-4;const t=e.pull();if((0,r.Zh)(t)){const n=JSON.parse(t);void 0===e.geometry&&n.diameter&&(e.geometry=new i.cJO(.5*n.diameter,4)),n.step&&(document.getElementById("p_step").innerHTML=`Step: ${n.step} `),document.getElementById("p_pids").innerHTML=`Particles: ${n.pids.length} `,e.ctx_minimap.clearRect(0,0,e.minimap.width,e.minimap.height);let r=0;for(let t in n.parts){let a=n.parts[t];r<3e3&&(e.meshes.length==r&&(e.meshes.push(new i.Kj0(e.geometry,e.materials.default)),e.scene.add(e.meshes[r])),e.meshes[r].position.x=1*a.x,e.meshes[r].position.y=1*a.y,e.meshes[r].position.z=1*a.z,r++)}for(let n=r;n<e.meshes.length;n++)e.meshes[n].position.x=0,e.meshes[n].position.y=0,e.meshes[n].position.z=0}e.renderer.render(e.scene,e.camera),(0,a.O)(e);const o=performance.now();e.fps_counter.push({start:n,end:o,duration:o-n})}function s(){document.getElementById("content").innerHTML='  <canvas id="canvas"></canvas>\n  <div id="panel">\n    <canvas id="minimap"></canvas>\n    <p id="p_step"></p>\n    <p id="p_fps"></p>\n    <p id="p_render_duration"></p>\n    <p id="p_cps"></p>\n    <p id="p_compute_duration"></p>\n    <p id="p_pids"></p>\n  </div>\n';let e=new WebSocket("ws://127.0.0.1:8000/ws"),n={};e.onopen=function(n){console.log("[open] Connection established"),console.log("Sending to server"),e.send(JSON.stringify({request:"create_sender",uuid:(0,r.vc)()}))},e.onmessage=function(e){n=e.data},e.onclose=function(e){e.wasClean?console.error(`[close] Connection closed cleanly, code=${e.code} reason=${e.reason}`):console.error("[close] Connection died")},e.onerror=function(e){console.error(`[error] ${e.message}`)},o({pull:function(){return n},fps_counter_length:100,fps_counter:[],image_width:512,image_height:512,fov:65,clipping:{near:.01,far:5}})}},603:(e,n,t)=>{"use strict";t.d(n,{pY:()=>d,uE:()=>s,dC:()=>o,FF:()=>p,kG:()=>c,Fv:()=>i,U1:()=>u,IH:()=>r,IV:()=>a});const i=(e,n)=>(n||(n=l(e)),{x:e.x/n,y:e.y/n}),r=(e,n)=>({x:n.x+e.x,y:n.y+e.y}),a=(e,n)=>({x:e.x-n.x,y:e.y-n.y}),o=(e,n)=>({x:e.x*n,y:e.y*n}),d=(e,n)=>({x:n.x-e.x,y:n.y-e.y}),s=(e,n)=>{void 0===n&&(n={x:0,y:0});const t=d(e,n);return t.x*t.x+t.y*t.y},l=(e,n)=>Math.sqrt(s(e,n)),p=(e,n)=>{const t={x:e.dp.x-n.dp.x,y:e.dp.y-n.dp.y},i={x:e.np.x-n.np.x,y:e.np.y-n.np.y};let r=(a=t).x*(o=i).x+a.y*o.y;var a,o;let d=l({x:0,y:0},i),s=1*r/(d*d);return{x:i.x*s,y:i.y*s}},c=(e,n)=>{let t=1.25,i=1.5,r={x:(e.x+t)%1,y:(e.y+t)%1},a={x:(n.x+t)%1,y:(n.y+t)%1},o={x:(e.x+i)%1,y:(e.y+i)%1},d={x:(n.x+i)%1,y:(n.y+i)%1};const l=s(e,n),p=s(r,a),c=s(o,d);return l<p?l<c?{a:e,b:n,d_sqrd:l}:{a:o,b:d,d_sqrd:c}:p<c?{a:r,b:a,d_sqrd:p}:{a:o,b:d,d_sqrd:c}},u=(e,n,t)=>{t=2*Math.PI*t;const i=n.x-e.x,r=n.y-e.y,a=Math.cos(t),o=Math.sin(t);return{x:e.x+i*a-r*o,y:e.y+r*a+i*o}}},467:(e,n,t)=>{"use strict";t.d(n,{OZ:()=>a,e0:()=>o,Ov:()=>p,gk:()=>c,Xe:()=>u});const i=[];let r=0;const a=()=>{for(i.push(performance.now());i.length>100;)i.shift();const e=i.length,n=(i[e-1]-i[0])/e;r=1e3/n},o=()=>r.toFixed(1),d=[];let s=0,l=0;const p=()=>{for(d.push(performance.now());d.length>100;)d.shift();const e=d.length;l=(d[e-1]-d[0])/e,s=1e3/l},c=()=>s.toFixed(1),u=()=>l},340:(e,n,t)=>{"use strict";t.d(n,{L:()=>p});var i=t(980);let r,a;const o={},d={},s={frame:{values:[],size:100,start:void 0,value:void 0},render:{values:[],size:100,start:void 0,value:void 0},render_minimap:{values:[],size:100,start:void 0,value:void 0},render_view:{values:[],size:100,start:void 0,value:void 0}},l=[{location:"Germany",url:"ws://136.243.64.165:8000/ws"},{location:"Local",url:"ws://127.0.0.1:8000/ws"}];function p(){!function(){m("frame"),m("render"),document.getElementById("content").innerHTML=`<canvas id="canvas"></canvas>\n<div id="panel">\n\x3c!-- <div id="menu">\n  <a href="/playground">Playground</a>\n  <a href="/gallery">Gallery</a>\n  <a href="/gallery?webgpu=true">Gallery (WebGPU)</a>\n</div> --\x3e\n  <canvas id="minimap"></canvas>\n  ${function(){let e="";const n=new URL(window.location.href);for(var t of l){let i="";n.searchParams.get("location")&&t.location.toLowerCase()===n.searchParams.get("location").toLowerCase()&&(i="selected"),e+=`<option value="${t.url}" ${i}>${t.location}</option>`}return`  <div>\n    <select name="url_selector" id="url_selector">\n      ${e}\n    </select>\n    <span id="connection_status">Connecting</span>\n  </div>`}()}\n  <div>\n    Zoom: <input type="range" min="0" max="1000" value="900" id="zoom_slider">\n  </div>\n  <div>\n    x: <input type="range" min="0" max="1000" value="100" id="x_slider">\n  </div>\n  <div>\n    y: <input type="range" min="0" max="1000" value="100" id="y_slider">\n  </div>\n  <p id="p_step"></p>\n  <p id="p_fps"></p>\n  <div>\n    Color by kind: <input type="checkbox" id="color_by_kind_checkbox">\n  </div>\n\n  <p id="p_counter_frame"></p>\n  <p id="p_counter_render"></p>\n  <p id="p_counter_render_minimap"></p>\n  <p id="p_counter_render_view"></p>\n\n  <p id="p_render_duration"></p>\n  <p id="p_counter_map"></p>\n  <p id="p_counter_await_map"></p>\n  <p id="p_counter_put_image"></p>\n  <p id="p_cps"></p>\n  <p id="p_compute_duration"></p>\n  <p id="p_pids"></p>\n  <pre id="p_counter_global"></pre>\n  <pre id="p_counter_activity"></pre>\n  <pre id="p_counter_collision"></pre>\n  <pre id="p_counter_linked"></pre>\n  <p id="p_energy"></p>\n</div>`,o.canvas=document.getElementById("minimap"),o.context=o.canvas.getContext("2d");const e=256;o.canvas.width=e,o.canvas.height=e,o.canvas.style.width=e+"px",o.canvas.style.height=e+"px",d.canvas=document.getElementById("canvas"),d.context=d.canvas.getContext("2d"),d.canvas.width=window.innerWidth,d.canvas.height=window.innerHeight,d.canvas.style.width=window.innerWidth+"px",d.canvas.style.height=window.innerHeight+"px",document.getElementById("url_selector").addEventListener("change",(function(){y()}))}(),y(),c()}function c(){g("frame"),m("frame"),m("render");const e={x:document.getElementById("x_slider").value/1e3,y:document.getElementById("y_slider").value/1e3,zoom:1e3/(1e3-document.getElementById("zoom_slider").value)};if(void 0!==r){const n=new DataView(r),t=!0,i=n.getUint32(0,t),a=(n.getUint32(4,t),n.getUint32(8,t),n.getUint32(12,t),n.getUint32(16,t),n.getUint32(20,t),n.getUint32(24,t),n.getUint32(28,t)),s=f(d),l=e.x-.5/e.zoom*d.canvas.width/s,p=e.y-.5/e.zoom*d.canvas.height/s,c=l+1/e.zoom*d.canvas.width/s,y=p+1/e.zoom*d.canvas.height/s;m("render_minimap"),u(o.canvas,o.context,"#ffff0004"),function(e,n,t){const i=f(t);n.context.beginPath(),n.context.fillStyle="#ff000088",n.context.rect(e.x*n.canvas.width-.5*n.canvas.width/e.zoom,e.y*n.canvas.height-.5*n.canvas.height/e.zoom,n.canvas.width/e.zoom,n.canvas.height/e.zoom),n.context.fill(),n.context.beginPath(),n.context.fillStyle="#FFFF0088",n.context.rect(e.x*n.canvas.width-.5*n.canvas.width/e.zoom*t.canvas.width/i,e.y*n.canvas.height-.5*n.canvas.height/e.zoom*t.canvas.height/i,n.canvas.width/e.zoom*t.canvas.width/i,n.canvas.height/e.zoom*t.canvas.height/i),n.context.fill(),n.context.fillStyle="#000"}(e,o,d);const h=55;for(let e=0;e<a;e+=2){const i=40+e*h,r=n.getFloat32(i+0,t),a=(n.getFloat32(i+4,t),n.getFloat32(i+8,t)),d=n.getFloat32(i+12,t),s=(n.getUint32(i+24,t),l<=a&&a<=c&&p<=d&&d<=y);_(a,d,2*r,o.context,s,o.canvas)}g("render_minimap"),m("render_view"),u(d.canvas,d.context,"#012");const b=.5*(1-1/e.zoom),x=b*d.canvas.width/s,w=b*d.canvas.height/s,v=(s-d.canvas.width)/s*.5,k=(s-d.canvas.height)/s*.5,S=document.getElementById("color_by_kind_checkbox").checked;for(let i=0;i<a;i+=1){const r=40+i*h,a=n.getFloat32(r+0,t),o=(n.getFloat32(r+4,t),n.getFloat32(r+8,t)),u=n.getFloat32(r+12,t),f=n.getUint8(r+52,t),_=n.getUint8(r+52+1,t),m=n.getUint8(r+52+2,t),g=n.getUint32(r+24,t),b=Math.max(0,Math.min(1,n.getFloat32(r+28,t))),P=n.getFloat32(r+32,t);if(l<=o&&o<=c&&p<=u&&u<=y){if(S){if(2==g){d.context.fillStyle="#aaa";let e=0,n=0;b>.5?(n=1,e=2*(1-b)):(e=1,n=2*b);let t=0;d.context.fillStyle=`rgba(${255*e}, ${255*n}, ${255*t}, 1.0)`}else if(5==g){d.context.fillStyle="#aaa";let e=.55+.45*b,n=.55+.45*b,t=.45;d.context.fillStyle=`rgba(${255*e}, ${255*n}, ${255*t}, 1.0)`}else if(8==g)d.context.fillStyle="#eee";else if(3==g){d.context.fillStyle="#f80";let e=1,n=1-P,t=0;d.context.fillStyle=`rgba(${255*e}, ${255*n}, ${255*t}, 1.0)`}else if(4==g)d.context.fillStyle="#f80";else if(1==g){let e=0,n=0,t=0;b>.5?(t=1,n=1,e=2*(1-b)):(e=1,t=2*b,n=2*b),d.context.fillStyle=`rgba(${255*e}, ${255*n}, ${255*t}, 1.0)`}else d.context.fillStyle=0==g?"#0F0":"#f0f";d.context.beginPath(),d.context.arc((o+.5-e.x-x-v)*e.zoom*s,(u+.5-e.y-w-k)*e.zoom*s,a*s*.5*e.zoom,0,2*Math.PI),d.context.fill()}else 8==g||(d.context.fillStyle=`rgba(${.5*f+128}, ${.5*_+128}, ${.5*m+128}, 1.0)`,d.context.beginPath(),d.context.arc((o+.5-e.x-x-v)*e.zoom*s,(u+.5-e.y-w-k)*e.zoom*s,a*s*.5*e.zoom,0,2*Math.PI),d.context.fill());8==g&&(d.context.fillStyle="#eee",d.context.beginPath(),d.context.arc((o+.5-e.x-x-v)*e.zoom*s,(u+.5-e.y-w-k)*e.zoom*s,a*s*.5*e.zoom,0,2*Math.PI),d.context.fill(),d.context.fillStyle="#111",d.context.beginPath(),d.context.arc((o+.5-e.x-x-v)*e.zoom*s,(u+.5-e.y-w-k)*e.zoom*s,a*s*.3*e.zoom,0,2*Math.PI),d.context.fill())}}g("render_view"),document.getElementById("p_step").innerHTML=`Step: ${i}`}!function(){for(let e in s)if((0,i.Zh)(s[e].values)>0){for(;(0,i.Zh)(s[e].values)>s[e].size;)s[e].values.shift();let n=0;for(let t of s[e].values)n+=t;s[e].value=n/(0,i.Zh)(s[e].values),document.getElementById(`p_counter_${e}`).innerHTML=`${e}: ${s[e].value.toFixed(2)}ms`}}(),document.getElementById("p_fps").innerHTML=`FPS: ${(1e3/s.frame.value).toFixed(0)}`,window.requestAnimationFrame((function(){c()})),g("render")}function u(e,n,t){n.beginPath(),n.fillStyle=t,n.rect(0,0,e.width,e.height),n.fill()}function f(e){return Math.max(e.canvas.width,e.canvas.height)}function _(e,n,t,i,r,a){i.fillStyle=r?"#000":"#888",i.beginPath(),i.arc(e*a.width,n*a.height,t*a.width*.5,0,2*Math.PI),i.fill()}function m(e){s[e].start=performance.now()}function g(e){s[e].values.push(performance.now()-s[e].start)}function y(){document.getElementById("connection_status").innerHTML="Connecting...";let e=document.getElementById("url_selector").selectedOptions[0].value;a&&a.close(),a=new WebSocket(e),a.binaryType="arraybuffer",a.onopen=function(e){document.getElementById("connection_status").innerHTML="Connected",console.log("[open] Connection established"),a.send(JSON.stringify({request:"create_sender",uuid:(0,i.vc)()}))},a.onmessage=function(e){r=e.data},a.onclose=function(e){document.getElementById("connection_status").innerHTML="Closed",e.wasClean?console.error(`[close] Connection closed cleanly, code=${e.code} reason=${e.reason}`):(console.error("[close] Connection died"),console.error("        Retrying in 1 sec."),window.setTimeout((function(){y()}),1e3))},a.onerror=function(e){document.getElementById("connection_status").innerHTML="Error",console.error(e),console.error(`[error] ${e.message}`)},console.log("Waiting for server")}},45:(e,n,t)=>{"use strict";t.d(n,{s:()=>d,H:()=>o});var i=t(189),r=t(737),a=t(603);const o=(e,n,t,o,d,s)=>{(0,r.ZH)(e);for(let t of n)t.deleted||(t.activated&&"booster"==t.kind?((0,r.FR)(e,(0,a.IH)(t.p,(0,a.dC)(t.direction,.007+.003*Math.random())),.7*t.d,i.O[t.kind].value_3),(0,r.FR)(e,(0,a.IH)(t.p,(0,a.dC)(t.direction,.005+.001*Math.random())),.9*t.d,i.O[t.kind].value_2),(0,r.FR)(e,t.p,t.d,i.O[t.kind].value_1)):"booster"==t.kind?(0,r.FR)(e,t.p,.75*t.d,i.O[t.kind].value):(0,r.FR)(e,t.p,.75*t.d,i.O[t.kind].value[t.player_id]),t.binding&&(0,r.aV)(e,t.p,t.binding,20,"#222"));for(let n of t)(0,r.eG)(e,n.p,.75*n.d,i.O[n.kind].value[n.player_id]);for(let n of o)(0,r.eG)(e,n.p,.75*n.d,i.O[n.kind].value[n.player_id]);(0,r.eG)(e,d,.01,"#222"),(0,r.eG)(e,d,.013,"#ffa");for(let n of s)n.deleted||(0,r.FR)(e,n.p,.75*n.d,"#8e8")},d=(e,n,t)=>{for(let t of n)t.deleted||(t.activated&&"booster"==t.kind?((0,r.FR)(e,(0,a.IH)(t.p,(0,a.dC)(t.direction,.007+.003*Math.random())),.7*t.d,i.O[t.kind].value_3),(0,r.FR)(e,(0,a.IH)(t.p,(0,a.dC)(t.direction,.005+.001*Math.random())),.9*t.d,i.O[t.kind].value_2),(0,r.FR)(e,t.p,t.d,i.O[t.kind].value_1)):"booster"==t.kind?(0,r.FR)(e,t.p,t.d,i.O[t.kind].value):(0,r.FR)(e,t.p,t.d,i.O[t.kind].value[t.player_id]));for(let o of Object.keys(i.O))for(let d of t){if(d.deleted)continue;const t=n[d.a],s=n[d.b],l=(0,a.kG)(t.np,s.np),p=(0,a.dC)((0,a.pY)(l.a,l.b),.5),c=i.O[t.kind].score>i.O[s.kind].score?t.kind:s.kind;if(o==c){const n=i.O[c].value[s.player_id],o=.75;(0,r.FR)(e,(0,a.IH)(t.p,p),t.d*o,n),(0,r.FR)(e,(0,a.IV)(s.p,p),s.d*o,n)}}for(let e of t){const t=n[e.a],i=n[e.b],r=(0,a.kG)(t.np,i.np);(0,a.pY)(r.a,r.b)}for(let e of n);}},654:(e,n,t)=>{"use strict";t.d(n,{lX:()=>i,Hm:()=>a,Bz:()=>o,bc:()=>r});const i='{"links":[{"a":2,"b":1},{"a":3,"b":2},{"a":4,"b":0},{"a":5,"b":4},{"a":6,"b":5},{"a":7,"b":6},{"a":8,"b":1},{"a":9,"b":8},{"a":10,"b":2},{"a":10,"b":3},{"a":11,"b":2},{"a":11,"b":1},{"a":12,"b":11},{"a":12,"b":1},{"a":12,"b":8},{"a":13,"b":11},{"a":13,"b":3},{"a":13,"b":2},{"a":14,"b":12},{"a":14,"b":8},{"a":14,"b":9},{"a":15,"b":11},{"a":15,"b":12},{"a":16,"b":15},{"a":16,"b":12},{"a":16,"b":14},{"a":17,"b":9},{"a":18,"b":17},{"a":18,"b":9},{"a":19,"b":14},{"a":19,"b":9},{"a":19,"b":17},{"a":20,"b":7},{"a":21,"b":7},{"a":21,"b":20},{"a":22,"b":0},{"a":22,"b":4},{"a":23,"b":20},{"a":23,"b":7},{"a":24,"b":23},{"a":24,"b":7},{"a":24,"b":6},{"a":25,"b":5},{"a":25,"b":4},{"a":26,"b":25},{"a":26,"b":24},{"a":26,"b":6},{"a":26,"b":5},{"a":27,"b":25},{"a":27,"b":4},{"a":27,"b":0},{"a":28,"b":26},{"a":28,"b":25},{"a":29,"b":28},{"a":29,"b":24},{"a":29,"b":26}],"parts":[{"p":{"x":0.7750000000000001,"y":0.8},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.8500000000000001,"y":0.8},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8375,"y":0.8},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8250000000000001,"y":0.8},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.7625000000000002,"y":0.8},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7500000000000001,"y":0.8},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7375000000000002,"y":0.8},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7250000000000001,"y":0.8},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.8625,"y":0.8},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8750000000000001,"y":0.8},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.83125,"y":0.7891746824526945},"d":0.0125,"player_id":"1","kind":"booster","binding":"k"},{"p":{"x":0.8437500000000001,"y":0.8108253175473056},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8562500000000001,"y":0.8108253175473055},"d":0.0125,"player_id":"1","kind":"core"},{"p":{"x":0.83125,"y":0.8108253175473056},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.86875,"y":0.8108253175473055},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8500000000000001,"y":0.821650635094611},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8625,"y":0.821650635094611},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8875000000000002,"y":0.8},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.8812500000000001,"y":0.7891746824526945},"d":0.0125,"player_id":"1","kind":"booster","binding":"l"},{"p":{"x":0.8812500000000001,"y":0.8108253175473055},"d":0.0125,"player_id":"1","kind":"armor"},{"p":{"x":0.7125000000000001,"y":0.8},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7187500000000001,"y":0.7891746824526946},"d":0.0125,"player_id":"0","kind":"booster","binding":"s"},{"p":{"x":0.7687500000000002,"y":0.7891746824526946},"d":0.0125,"player_id":"0","kind":"booster","binding":"d"},{"p":{"x":0.7187500000000001,"y":0.8108253175473055},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7312500000000002,"y":0.8108253175473055},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7562500000000002,"y":0.8108253175473055},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7437500000000001,"y":0.8108253175473055},"d":0.0125,"player_id":"0","kind":"core"},{"p":{"x":0.7687500000000002,"y":0.8108253175473055},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7500000000000002,"y":0.821650635094611},"d":0.0125,"player_id":"0","kind":"armor"},{"p":{"x":0.7375000000000002,"y":0.821650635094611},"d":0.0125,"player_id":"0","kind":"armor"}],"center":{"x":0.8,"y":0.8},"DIAM":0.0125}',r='{"links":[{"a":2,"b":1},{"a":3,"b":0},{"a":4,"b":0},{"a":5,"b":1},{"a":6,"b":5},{"a":6,"b":4},{"a":7,"b":4},{"a":7,"b":6},{"a":8,"b":7},{"a":8,"b":6},{"a":8,"b":5},{"a":9,"b":4},{"a":9,"b":0},{"a":10,"b":6},{"a":10,"b":4},{"a":10,"b":9},{"a":11,"b":5},{"a":11,"b":6},{"a":11,"b":10},{"a":12,"b":1},{"a":12,"b":5},{"a":12,"b":11},{"a":3,"b":9},{"a":2,"b":12},{"a":13,"b":9},{"a":13,"b":3},{"a":14,"b":2},{"a":14,"b":12}],"parts":[{"p":{"x":0.7800000000000001,"y":0.8},"d":0.01,"player_id":"0","kind":"armor"},{"p":{"x":0.8200000000000001,"y":0.8},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.8250000000000001,"y":0.7913397459621556},"d":0.01,"player_id":0,"kind":"armor","binding":null},{"p":{"x":0.7750000000000001,"y":0.7913397459621557},"d":0.01,"player_id":0,"kind":"armor","binding":null},{"p":{"x":0.7900000000000001,"y":0.8},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.81,"y":0.8},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.8,"y":0.8},"d":0.01,"player_id":0,"kind":"core"},{"p":{"x":0.7950000000000002,"y":0.8086602540378445},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.805,"y":0.8086602540378445},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.7850000000000001,"y":0.7913397459621556},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.7950000000000002,"y":0.7913397459621556},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.805,"y":0.7913397459621556},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.8150000000000001,"y":0.7913397459621556},"d":0.01,"player_id":0,"kind":"armor"},{"p":{"x":0.7800000000000001,"y":0.7826794919243113},"d":0.01,"player_id":0,"kind":"booster","binding":"s"},{"p":{"x":0.8200000000000001,"y":0.7826794919243112},"d":0.01,"player_id":0,"kind":"booster","binding":"d"}],"center":{"x":0.8,"y":0.8},"DIAM":0.01}',a={p1:"core",p2:"armor",parts:[[0,1,"armor"],[0,2,"armor"],[0,3,"armor"],[0,4,"armor"],[0,5,"armor"]],links:[[1,6]],key_bindings:{}},o={p1:"emerald",p2:"emerald",parts:[[0,1,"emerald"],[1,0,"emerald"]],links:[],key_bindings:{}}},555:(e,n,t)=>{"use strict";t.d(n,{U:()=>r});const i=e=>{localStorage.setItem(`slider_${e}`,document.querySelector(`#slider_${e}`).value)},r=()=>{window.change_slider=i,document.querySelector("#content").innerHTML=`\n    <div id="winner" class="hide">\n      ${localStorage.getItem("slider_0")||localStorage.setItem("slider_0",100),`\n    <input oninput="change_slider('0')" type="range" min="0" max="1000" id="slider_0" value="${localStorage.getItem("slider_0")}"></input>\n  `}\n    </div>\n  `;const e=document.createElement("style");document.head.appendChild(e);for(let n of"\n      input {\n        width: 30rem;\n      }\n    ".split("}"))try{e.sheet.insertRule(n+"}")}catch(e){}const n=new(window.AudioContext||window.webkitAudioContext),t=n.createOscillator(),r=n.createGain();r.gain.value=0,t.type="square",t.frequency.linearRampToValueAtTime(30,n.currentTime),t.connect(r),r.connect(n.destination),t.start(),document.addEventListener("keydown",(e=>{if("s"==e.key){const e=n.currentTime;r.gain.linearRampToValueAtTime(.25,e+.01),t.frequency.linearRampToValueAtTime(100*(0,document.querySelector("#slider_0").value/1e3),e+.01)}})),document.addEventListener("keyup",(e=>{"s"==e.key&&r.gain.linearRampToValueAtTime(0,n.currentTime+.5)}))}},250:(e,n,t)=>{"use strict";t.d(n,{l:()=>i,z:()=>r});const i=e=>{document.querySelector("#content").innerHTML=e},r=e=>{const n=document.createElement("style");document.head.appendChild(n);for(let t of e.split("}"))try{n.sheet.insertRule(t+"}")}catch(e){}}},690:(e,n,t)=>{"use strict";t.a(e,(async e=>{t.d(n,{M:()=>p});var i=t(650),r=(t(411),t(162),t(361)),a=t(437),o=t(209),d=t(291),s=t(980),l=e([r,i]);[r,i]=l.then?await l:l;function p(){let e=!1;const n=window.location.search.replace("?","").split("&");for(var t of n)t.split("=")[0],t.split("=")[1],e=!0;document.getElementById("content").innerHTML='<canvas id="canvas"></canvas>\n<div id="panel">\n<div id="menu">\n  <a href="/playground">Playground</a>\n  <a href="/gallery">Gallery</a>\n  <a href="/gallery?webgpu=true">Gallery (WebGPU)</a>\n</div>\n  <canvas id="minimap"></canvas>\n  <div>\n    Zoom: <input type="range" min="0" max="1000" value="900" id="zoom_slider">\n  </div>\n  <div>\n    x: <input type="range" min="0" max="1000" value="500" id="x_slider">\n  </div>\n  <div>\n    y: <input type="range" min="0" max="1000" value="500" id="y_slider">\n  </div>\n  <p id="p_step"></p>\n  <p id="p_fps"></p>\n  <p id="p_render_duration"></p>\n  <p id="p_counter_map"></p>\n  <p id="p_counter_await_map"></p>\n  <p id="p_counter_put_image"></p>\n  <p id="p_cps"></p>\n  <p id="p_compute_duration"></p>\n  <p id="p_pids"></p>\n  <pre id="p_counter_global"></pre>\n  <pre id="p_counter_activity"></pre>\n  <pre id="p_counter_collision"></pre>\n  <pre id="p_counter_linked"></pre>\n  <p id="p_energy"></p>\n</div>';const r=i.xF.new(128,128),d=i.fU.new(5,.25,5);d.add(0,1,6),d.add(1,0,7);let s=3;s=5,d.add(1,3,5),d.add(3,0,5),d.add(1,4,5),d.add(5,0,5),d.add(1,6,6),d.add(7,0,6),d.add(6,4,5),d.add(5,7,5),r.add_entity_full(d,i.E9.new(.5,.5));for(var l=0;l<100;l++)r.add_entity(d,i.E9.new(Math.random(),Math.random()));if(x(r),"gpu"in navigator)!async function(e){const n=await navigator.gpu.requestAdapter();if(!n)return void console.error("No gpu adapter found");const t={buffer_size:212992},i={data_buffer_size:t.buffer_size,image_width:Math.floor(1*window.innerWidth),image_height:Math.floor(1*window.innerHeight),max_parts_sqrt:64};i.device=await n.requestDevice(),i.buffers={write:i.device.createBuffer({size:t.buffer_size,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),in:i.device.createBuffer({size:t.buffer_size,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),out:i.device.createBuffer({size:g(i),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),previous_img:i.device.createBuffer({size:g(i),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),read:i.device.createBuffer({size:g(i),usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),write_data:i.device.createBuffer({size:48,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),in_data:i.device.createBuffer({size:48,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC})},i.bind_group_layouts={reset:i.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),trace:i.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]})},i.bind_groups={reset:i.device.createBindGroup({layout:i.bind_group_layouts.reset,entries:[{binding:0,resource:{buffer:i.buffers.previous_img}},{binding:1,resource:{buffer:i.buffers.out}}]}),trace:i.device.createBindGroup({layout:i.bind_group_layouts.trace,entries:[{binding:0,resource:{buffer:i.buffers.in}},{binding:1,resource:{buffer:i.buffers.out}},{binding:2,resource:{buffer:i.buffers.in_data}}]})},i.workgroup_size=16,i.dispatch=Math.ceil(64/i.workgroup_size),i.compute_pipelines={reset:i.device.createComputePipeline({layout:i.device.createPipelineLayout({bindGroupLayouts:[i.bind_group_layouts.reset]}),compute:{module:i.device.createShaderModule({code:a.U(i)}),entryPoint:"main"}}),trace:i.device.createComputePipeline({layout:i.device.createPipelineLayout({bindGroupLayouts:[i.bind_group_layouts.trace]}),compute:{module:i.device.createShaderModule({code:o.U(i)}),entryPoint:"main"}})};const r=document.getElementById("canvas");r.width=i.image_width,r.height=i.image_height,r.style.width=window.innerWidth+"px",r.style.height=window.innerHeight+"px";m(e,i,r.getContext("2d"))}(r);else{const e="Gravitle works best with WebGPU.\nInstructions on how to enable at https://web.dev/gpu/#use";alert(e),console.error(e),b(r)}}const c={};for(var u of["put_image","map","await_map"])c[u]={start:performance.now(),values:[],max:100};function f(e){c[e].start=performance.now()}function _(e){c[e].values.push(performance.now()-c[e].start)}async function m(e,n,t){const i=performance.now();void 0===n.fps_counter&&(n.fps_counter=[]),void 0===n.fps_counter_length&&(n.fps_counter_length=100);const a=Math.max(canvas.width,canvas.height),o={x:document.getElementById("x_slider").value/1e3,y:document.getElementById("y_slider").value/1e3,zoom:1e3/(1e3-document.getElementById("zoom_slider").value)},l=(y(o,a).canvas,new Float32Array(new Float32Array(r.memory.buffer,e.parts_ptr(),13*e.parts_count()))),p=(canvas.width,canvas.height,o.x-.5/o.zoom*n.image_width/a),u=o.y-.5/o.zoom*n.image_height/a,h=p+1/o.zoom*n.image_width/a,b=u+1/o.zoom*n.image_height/a;e.parts_count(),f("map");let x=n.buffers.read.mapAsync(GPUMapMode.READ),w=n.buffers.write.mapAsync(GPUMapMode.WRITE),v=n.buffers.write_data.mapAsync(GPUMapMode.WRITE);f("await_map"),await x,await w,await v,_("await_map");const k=e.parts_count();new Float32Array(n.buffers.write_data.getMappedRange()).set([o.zoom,o.x,o.y,k,n.image_width,n.image_height,p,u,h,b,performance.now(),e.get_step()/1]),f("put_image"),t.putImageData(new ImageData(Uint8ClampedArray.from(new Uint32Array(n.buffers.read.getMappedRange())),n.image_width,n.image_height),0,0),_("put_image"),new Float32Array(n.buffers.write.getMappedRange()).set(l),n.buffers.write.unmap(),n.buffers.write_data.unmap(),n.buffers.read.unmap(),_("map");{const e=n.device.createCommandEncoder(),t=e.beginComputePass();t.setPipeline(n.compute_pipelines.reset),t.setBindGroup(0,n.bind_groups.reset),t.dispatch(n.image_width,n.image_height),t.endPass();const i=e.finish();n.device.queue.submit([i])}{const e=n.device.createCommandEncoder();e.copyBufferToBuffer(n.buffers.write,0,n.buffers.in,0,n.data_buffer_size),e.copyBufferToBuffer(n.buffers.write_data,0,n.buffers.in_data,0,48);const t=e.beginComputePass();t.setPipeline(n.compute_pipelines.trace),t.setBindGroup(0,n.bind_groups.trace),t.dispatch(n.dispatch,n.dispatch),t.endPass(),e.copyBufferToBuffer(n.buffers.out,0,n.buffers.read,0,g(n)),e.copyBufferToBuffer(n.buffers.out,0,n.buffers.previous_img,0,g(n));const i=e.finish();n.device.queue.submit([i])}for(let e in c)if((0,s.Zh)(c[e].values)>0){for(;(0,s.Zh)(c[e].values)>c[e].max;)c[e].values.shift();let n=0;for(let t of c[e].values)n+=t;n/=(0,s.Zh)(c[e].values),document.getElementById(`p_counter_${e}`).innerHTML=`${e}: ${n.toFixed(2)}ms`}document.getElementById("p_counter_global").innerHTML=`Compute:     ${e.get_counter_value(0).toFixed(2)}ms`,document.getElementById("p_counter_activity").innerHTML=`  Activity:  ${e.get_counter_value(2).toFixed(2)}ms`,document.getElementById("p_counter_collision").innerHTML=`  Collision: ${e.get_counter_value(1).toFixed(2)}ms`,document.getElementById("p_counter_linked").innerHTML=`    Linked:  ${e.get_counter_value(3).toFixed(2)}ms`,document.getElementById("p_energy").innerHTML=`Energy: ${e.get_total_energy().toFixed(2)}`,(0,d.O)(n),window.requestAnimationFrame((function(){m(e,n,t)}));const S=performance.now();n.fps_counter.push({start:i,end:S,duration:S-i})}function g(e){return e.image_width*e.image_height*4*4}function y(e,n){const t=document.getElementById("minimap");t.width=256,t.height=256;const i=t.getContext("2d");return i.beginPath(),i.fillStyle="#ff000088",i.rect(e.x*t.width-.5*t.width/e.zoom,e.y*t.height-.5*t.height/e.zoom,t.width/e.zoom,t.height/e.zoom),i.fill(),i.beginPath(),i.fillStyle="#FFFF0088",i.rect(e.x*t.width-.5*t.width/e.zoom*canvas.width/n,e.y*t.height-.5*t.height/e.zoom*canvas.height/n,t.width/e.zoom*canvas.width/n,t.height/e.zoom*canvas.height/n),i.fill(),i.fillStyle="#000",i}function h(e,n,t,i,r){i.fillStyle=r?"#888":"#000",i.beginPath(),i.arc(e*minimap.width,n*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc((e+1)*minimap.width,n*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc((e-1)*minimap.width,n*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(e*minimap.width,(n+1)*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(e*minimap.width,(n-1)*minimap.height,t*minimap.width*.5,0,2*Math.PI),i.fill()}function b(e){const n=document.getElementById("canvas");n.width=window.innerWidth,n.height=window.innerHeight,n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px";const t=n.getContext("2d"),i=Math.max(n.width,n.height),a={x:document.getElementById("x_slider").value/1e3,y:document.getElementById("y_slider").value/1e3,zoom:1e3/(1e3-document.getElementById("zoom_slider").value)},o=y(a,i),d=(o.canvas,new Float32Array(r.memory.buffer,e.parts_ptr(),13*e.parts_count())),s=.5*(1-1/a.zoom),l=s*n.width/i,p=s*n.height/i,c=(i-n.width)/i*.5,u=(i-n.height)/i*.5;for(let n=0;n<e.parts_count();n++){const e=d[13*n+0],r=d[13*n+1],s=d[13*n+4];h(e,r,s,o),t.fillStyle="#aaa",t.beginPath(),t.arc((e+.5-a.x-l-c)*a.zoom*i,(r+.5-a.y-p-u)*a.zoom*i,s*i*.5*a.zoom,0,2*Math.PI),t.fill()}window.requestAnimationFrame((function(){b(e)}))}function x(e){e.tick(),window.setTimeout((async function(){await x(e)}),5)}}))},291:(e,n,t)=>{"use strict";t.d(n,{O:()=>r});var i=t(980);function r(e){if((0,i.Zh)(e.fps_counter)>0){for(;(0,i.Zh)(e.fps_counter)>e.fps_counter_length;)e.fps_counter.shift();let n=0;for(let t of e.fps_counter)n+=t.duration;n/=(0,i.Zh)(e.fps_counter),document.getElementById("p_render_duration").innerHTML=`Render: ${n.toFixed(2)}ms`,document.getElementById("p_fps").innerHTML=`FPS: ${((0,i.Zh)(e.fps_counter)/((0,i.Z$)(e.fps_counter).end-e.fps_counter[0].start)*1e3).toFixed(1)} `}}},437:(e,n,t)=>{"use strict";function i(e){return`// Render shader\n// struct Part {\n//   x: f32;\n//   y: f32;\n//   x_old: f32;\n//   y_old: f32;\n//   m: f32;\n//   d: f32;\n//   d: f32;\n// };\n// [[block]] struct Data {\n//   zoom: f32;\n//   center_x: f32;\n//   center_y: f32;\n// };\n// [[block]] struct Parts {\n//   parts: array<Part>;\n// };\nstruct Pixel {\n  r: i32;\n  g: i32;\n  b: i32;\n  a: i32;\n};\n[[block]] struct Image {\n  pix: array<Pixel, ${e.image_width*e.image_height}>;\n};\n[[group(0), binding(0)]] var<storage, read>   input     : Image;\n[[group(0), binding(1)]] var<storage, write>  output    : Image;\n[[stage(compute), workgroup_size(2, 2)]]\nfn main([[builtin(global_invocation_id)]] gid : vec3<u32>) {\n  let pix_id = gid.x + gid.y * ${e.image_width}u;\n  // output.pix[pix_id].r = max(input.pix[pix_id].r - 1u, 0u);\n  // output.pix[pix_id].g = max(input.pix[pix_id].g - 1u, 0u);\n  // output.pix[pix_id].b = max(input.pix[pix_id].b - 1u, 0u);\n\n  let fade = 100;\n\n  output.pix[pix_id].r = min(max(input.pix[pix_id].r - fade, 0), 255);\n  output.pix[pix_id].g = min(max(input.pix[pix_id].g - fade, 0), 255);\n  output.pix[pix_id].b = min(max(input.pix[pix_id].b - fade, 0), 255);\n\n  output.pix[pix_id].a = 255;\n}\n`}t.d(n,{U:()=>i})},209:(e,n,t)=>{"use strict";function i(e){return`// Render shader\nstruct Part {\n  x: f32;\n  y: f32;\n  x_old: f32;\n  y_old: f32;\n  d: f32;\n  m: f32;\n  kind: u32;\n  ta: f32;\n  tb: f32;\n  tc: f32;\n  td: f32;\n  direction_x: f32;\n  direction_y:  f32;\n};\nstruct Kind {\n  FIREFLY: u32;\n  METAL: u32;\n  TURBO: u32;\n  DIATOM: u32;\n  NEURON: u32;\n  MOUTH:  u32;\n  CORE:  u32;\n  EGG:  u32;\n};\nlet kind: Kind = Kind(1u, 2u, 3u, 4u, 5u, 6u, 7u, 8u);\n[[block]] struct Data {\n  zoom: f32;\n  center_x: f32;\n  center_y: f32;\n  count: f32;\n  image_width: f32;\n  image_height: f32;\n  x_min: f32;\n  y_min: f32;\n  x_max: f32;\n  y_max: f32;\n  time: f32;\n  step: f32;\n};\n[[block]] struct Parts {\n  parts: array<Part>;\n};\nstruct Pixel {\n  r: u32;\n  g: u32;\n  b: u32;\n  a: u32;\n};\n[[block]] struct Image {\n  pix: array<Pixel, ${e.image_width*e.image_height}>;\n};\n[[group(0), binding(0)]] var<storage, read>   input     : Parts;\n[[group(0), binding(1)]] var<storage, write>  output    : Image;\n[[group(0), binding(2)]] var<storage, read>   data      : Data;\n[[stage(compute), workgroup_size(${e.workgroup_size}, ${e.workgroup_size})]]\nfn main([[builtin(global_invocation_id)]] gid : vec3<u32>) {\n  let part_id = gid.x + gid.y * ${e.max_parts_sqrt}u;\n  let zoom = min(10.0, data.zoom);\n  if (part_id <= u32(data.count))\n  {\n    let part = input.parts[part_id];\n    var part_x = part.x;\n    var part_y = part.y;\n    if (part_x > data.x_max) {\n      part_x = part_x - 1.0;\n    }\n    if (part_y > data.y_max) {\n      part_y = part_y - 1.0;\n    }\n\n    if (\n      data.x_min <= part_x && part_x <= data.x_max\n      && data.y_min <= part_y && part_y <= data.y_max\n    )\n    {\n      let x = part_x * zoom;\n      let y = part_y * zoom;\n      let cd_max = max(data.image_height, data.image_width);\n      let d = max(min(0.1, part.d), 0.0001);\n      let rayon  = d * 0.5 * zoom;\n      let cd_min = min(data.image_height, data.image_width);\n      let resolution = 0.00005 * zoom;\n      let boo = cd_max * 0.5 * (zoom - 1.0) ;\n      let bup_x = (0.5 - data.center_x) * zoom * cd_max - (cd_max - data.image_width) * 0.5 - boo;\n      let bup_y = (0.5 - data.center_y) * zoom * cd_max - (cd_max - data.image_height)* 0.5 - boo;\n\n      let i_min = -rayon;\n      let i_max = rayon;\n      let j_min = -rayon;\n      let j_max = rayon;\n\n      for (var i = i_min ; i < i_max ; i=i+resolution ) {\n        for (var j = j_min ; j < j_max ; j=j+resolution ) {\n          let xx = (x+i) * cd_max + bup_x ;\n          let yy = (y+j) * cd_max + bup_y ;\n          if (xx < data.image_width) {\n            let pix_id = u32(xx) + u32(yy) * u32(data.image_width);\n            // distance from center\n            let dc = sqrt(i*i+j*j) / (d * zoom * 0.5);\n            let angle_ = fract(1.75 - (0.5 - 0.5*j/abs(j) * acos(normalize(vec2<f32>(i, j)).x) * 0.3183098861837907));\n            let angle = fract(angle_ + data.time * 0.00025);\n            if ( dc < 1.0) {\n              var r = 0.0;\n              var g = 0.0;\n              var b = 0.0;\n              if (part.kind == kind.FIREFLY) {\n                // output.pix[pix_id].r = 150u + u32(255.0 * dc );\n                // output.pix[pix_id].g = u32(255.0 * sin(angle*100.0)*dc);\n                // output.pix[pix_id].b = 0u;\n                // output.pix[pix_id].a = 255u;\n              } elseif (part.kind == kind.METAL) {\n                // output.pix[pix_id].r = 100u;\n                // output.pix[pix_id].g = 100u;\n                // output.pix[pix_id].b = 200u;\n                // output.pix[pix_id].a = 255u;\n              } elseif (part.kind == kind.MOUTH) {\n                r = 1.0;\n                g = 1.0;\n              } elseif (part.kind == kind.DIATOM) {\n                // output.pix[pix_id].r = 0u;\n                // output.pix[pix_id].g = 255u;\n                // output.pix[pix_id].b = 200u;\n                // output.pix[pix_id].a = 255u;\n              } elseif (part.kind == kind.TURBO) {\n                // r = 0.75 + part.ta ;\n                // g = 0.75;\n                r = 0.75;\n                g = part.ta *   (1.0-sin(dc*0.7));\n              } elseif (part.kind == kind.NEURON) {\n                r = 0.25;\n                g = part.ta *   (1.0-sin(dc*0.7));\n                b = part.ta *   (1.0-sin(dc*0.7));\n              } elseif (part.kind == kind.CORE) {\n                if (part.ta < 1.0) {\n                  r = 1.0 - part.ta;\n                  g = part.ta;\n                } else {\n                  b = part.ta - 1.0;\n                  g = 1.0;\n                }\n              } else {\n                r = 1.0;\n                b = 1.0;\n              }\n              output.pix[pix_id].r = u32(255.0 * r);\n              output.pix[pix_id].g = u32(255.0 * g);\n              output.pix[pix_id].b = u32(255.0 * b);\n              output.pix[pix_id].a = 255u;\n            }\n          }\n        }\n      }\n    }\n  }\n}\n`}t.d(n,{U:()=>i})},980:(e,n,t)=>{"use strict";t.d(n,{hu:()=>r,Z$:()=>o,Zh:()=>a,vc:()=>d});var i=t(586);function r(e){e||console.error("failed condition")}function a(e){return e.length}function o(e){return a(e)>0?e[a(e)-1]:void 0}function d(){return i.Z()}},162:(e,n,t)=>{"use strict";t(32)},411:(e,n,t)=>{"use strict";var i=t(980),r=t(32);Object.keys(r.N).length;let a=0;const o=a++;a++,a++,a++,a++,a++,a++,a++,a++,a++,a++,(0,i.hu)(0===o&&!0)},650:(e,n,t)=>{"use strict";t.a(e,(async i=>{t.d(n,{fU:()=>v,E9:()=>k,xF:()=>S,ug:()=>P,DW:()=>I,Ih:()=>M,yq:()=>U,gk:()=>E,Um:()=>z,vN:()=>B,mS:()=>O,C2:()=>T,cx:()=>C,rY:()=>G,Wl:()=>F,UE:()=>H,Im:()=>L,eY:()=>$,dS:()=>R,Oi:()=>A,gl:()=>q,wg:()=>j,BT:()=>D,JX:()=>N,xd:()=>Y,ud:()=>W,PT:()=>J,XP:()=>Z,jp:()=>V,y4:()=>X,YQ:()=>K,A7:()=>Q,b0:()=>ee,uf:()=>ne,m_:()=>te,Or:()=>ie,oH:()=>re});var r=t(361);e=t.hmd(e);var a=i([r]);r=(a.then?await a:a)[0];const o=new Array(32).fill(void 0);function d(e){return o[e]}o.push(void 0,null,!0,!1);let s=o.length;function l(e){s===o.length&&o.push(o.length+1);const n=s;return s=o[n],o[n]=e,n}let p=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});p.decode();let c=null;function u(){return null!==c&&c.buffer===r.memory.buffer||(c=new Uint8Array(r.memory.buffer)),c}function f(e,n){return p.decode(u().subarray(e,e+n))}function _(e,n){if(!(e instanceof n))throw new Error(`expected instance of ${n.name}`);return e.ptr}let m=0,g=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const y="function"==typeof g.encodeInto?function(e,n){return g.encodeInto(e,n)}:function(e,n){const t=g.encode(e);return n.set(t),{read:e.length,written:t.length}};let h=null;function b(){return null!==h&&h.buffer===r.memory.buffer||(h=new Int32Array(r.memory.buffer)),h}function x(e,n){try{return e.apply(this,n)}catch(e){r.__wbindgen_exn_store(l(e))}}function w(e,n){return u().subarray(e/1,e/1+n)}Object.freeze({Firefly:1,1:"Firefly",Metal:2,2:"Metal",Turbo:3,3:"Turbo",Diatom:4,4:"Diatom",Neuron:5,5:"Neuron",Mouth:6,6:"Mouth",Core:7,7:"Core",Egg:8,8:"Egg"}),Object.freeze({Activity:1,1:"Activity",Energy:3,3:"Energy",Bias:4,4:"Bias"});class v{static __wrap(e){const n=Object.create(v.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_plan_free(e)}get k1(){return r.__wbg_get_plan_k1(this.ptr)>>>0}set k1(e){r.__wbg_set_plan_k1(this.ptr,e)}get f(){return r.__wbg_get_plan_f(this.ptr)}set f(e){r.__wbg_set_plan_f(this.ptr,e)}get k2(){return r.__wbg_get_plan_k2(this.ptr)>>>0}set k2(e){r.__wbg_set_plan_k2(this.ptr,e)}static new(e,n,t){var i=r.plan_new(e,n,t);return v.__wrap(i)}add(e,n,t){r.plan_add(this.ptr,e,n,t)}}class k{static __wrap(e){const n=Object.create(k.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_point_free(e)}get x(){return r.__wbg_get_point_x(this.ptr)}set x(e){r.__wbg_set_point_x(this.ptr,e)}get y(){return r.__wbg_get_point_y(this.ptr)}set y(e){r.__wbg_set_point_y(this.ptr,e)}static new(e,n){var t=r.point_new(e,n);return k.__wrap(t)}}class S{static __wrap(e){const n=Object.create(S.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_server_free(e)}static new(e,n){var t=r.server_new(e,n);return S.__wrap(t)}add_part(e,n,t){_(n,k),_(t,k),r.server_add_part(this.ptr,e,n.ptr,t.ptr)}add_entity(e,n){_(e,v),_(n,k),r.server_add_entity(this.ptr,e.ptr,n.ptr)}add_entity_full(e,n){_(e,v),_(n,k),r.server_add_entity_full(this.ptr,e.ptr,n.ptr)}add_entity_(e,n,t){_(e,v),_(n,k),r.server_add_entity_(this.ptr,e.ptr,n.ptr,t)}tick(){r.server_tick(this.ptr)}parts_count(){return r.server_parts_count(this.ptr)>>>0}parts_ptr(){return r.server_parts_ptr(this.ptr)}get_step(){return r.server_get_step(this.ptr)>>>0}get_total_energy(){return r.server_get_total_energy(this.ptr)}get_counter_value(e){return r.server_get_counter_value(this.ptr,e)}}function P(e){!function(e){const n=d(e);(function(e){e<36||(o[e]=s,s=e)})(e)}(e)}function I(e,n){console.log(f(e,n))}function M(){return l(new Error)}function U(e,n){var t=function(e,n,t){if(void 0===t){const t=g.encode(e),i=n(t.length);return u().subarray(i,i+t.length).set(t),m=t.length,i}let i=e.length,r=n(i);const a=u();let o=0;for(;o<i;o++){const n=e.charCodeAt(o);if(n>127)break;a[r+o]=n}if(o!==i){0!==o&&(e=e.slice(o)),r=t(r,i,i=o+3*e.length);const n=u().subarray(r+o,r+i);o+=y(e,n).written}return m=o,r}(d(n).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),i=m;b()[e/4+1]=i,b()[e/4+0]=t}function E(e,n){try{console.error(f(e,n))}finally{r.__wbindgen_free(e,n)}}function z(e){return d(e)instanceof Window}function B(e){var n=d(e).performance;return null==n?0:l(n)}function O(e){return d(e).now()}function T(){return x((function(e,n){d(e).getRandomValues(d(n))}),arguments)}function C(){return x((function(e,n,t){d(e).randomFillSync(w(n,t))}),arguments)}function G(e){return l(d(e).process)}function F(e){const n=d(e);return"object"==typeof n&&null!==n}function H(e){return l(d(e).versions)}function L(e){return l(d(e).node)}function $(e){return"string"==typeof d(e)}function R(){return x((function(e,n){return l(t(964)(f(e,n)))}),arguments)}function A(e){return l(d(e).crypto)}function q(e){return l(d(e).msCrypto)}function j(e,n){return l(new Function(f(e,n)))}function D(){return x((function(e,n){return l(d(e).call(d(n)))}),arguments)}function N(){return x((function(){return l(self.self)}),arguments)}function Y(){return x((function(){return l(window.window)}),arguments)}function W(){return x((function(){return l(globalThis.globalThis)}),arguments)}function J(){return x((function(){return l(t.g.global)}),arguments)}function Z(e){return void 0===d(e)}function V(e){return l(d(e).buffer)}function X(e){return l(new Uint8Array(d(e)))}function K(e,n,t){d(e).set(d(n),t>>>0)}function Q(e){return d(e).length}function ee(e){return l(new Uint8Array(e>>>0))}function ne(e,n,t){return l(d(e).subarray(n>>>0,t>>>0))}function te(e){return l(d(e))}function ie(e,n){throw new Error(f(e,n))}function re(){return l(r.memory)}}))},964:e=>{function n(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}n.keys=()=>[],n.resolve=n,n.id=964,e.exports=n},361:(e,n,t)=>{"use strict";var i=([i])=>t.v(n,e.id,"5565d2ecda665c9da4d1",{"./wasm_bg.js":{__wbindgen_object_drop_ref:i.ug,__wbg_log_682923c8ea4d4d53:i.DW,__wbg_new_693216e109162396:i.Ih,__wbg_stack_0ddaca5d1abfb52f:i.yq,__wbg_error_09919627ac0992f5:i.gk,__wbg_instanceof_Window_c4b70662a0d2c5ec:i.Um,__wbg_performance_947628766699c5bb:i.vN,__wbg_now_559193109055ebad:i.mS,__wbg_getRandomValues_98117e9a7e993920:i.C2,__wbg_randomFillSync_64cc7d048f228ca8:i.cx,__wbg_process_2f24d6544ea7b200:i.rY,__wbindgen_is_object:i.Wl,__wbg_versions_6164651e75405d4a:i.UE,__wbg_node_4b517d861cbcb3bc:i.Im,__wbindgen_is_string:i.eY,__wbg_modulerequire_3440a4bcf44437db:i.dS,__wbg_crypto_98fc271021c7d2ad:i.Oi,__wbg_msCrypto_a2cdb043d2bfe57f:i.gl,__wbg_newnoargs_be86524d73f67598:i.wg,__wbg_call_888d259a5fefc347:i.BT,__wbg_self_c6fbdfc2918d5e58:i.JX,__wbg_window_baec038b5ab35c54:i.xd,__wbg_globalThis_3f735a5746d41fbd:i.ud,__wbg_global_1bc0b39582740e95:i.PT,__wbindgen_is_undefined:i.XP,__wbg_buffer_397eaa4d72ee94dd:i.jp,__wbg_new_a7ce447f15ff496f:i.y4,__wbg_set_969ad0a60e51d320:i.YQ,__wbg_length_1eb8fc608a0d4cdb:i.A7,__wbg_newwithlength_929232475839a482:i.b0,__wbg_subarray_8b658422a224f479:i.uf,__wbindgen_object_clone_ref:i.m_,__wbindgen_throw:i.Or,__wbindgen_memory:i.oH}});t.a(e,(e=>{var n=e([t(650)]);return n.then?n.then(i):i(n)}),1)}}]);